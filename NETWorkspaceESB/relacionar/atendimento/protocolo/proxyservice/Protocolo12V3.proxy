<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:http="http://www.bea.com/wli/sb/transports/http">
  <ser:coreEntry isProxy="true" isEnabled="true" isAutoPublish="false" isTracingEnabled="false" xmlns:ser="http://www.bea.com/wli/sb/services">
    <ser:description>Proxy que provê acesso ao serviço Protocolo pelo protocolo SOAP 1.2.</ser:description>
    <ser:binding type="SOAP" isSoap12="true" xsi:type="con:SoapBindingType" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config">
      <con:wsdl ref="relacionar/atendimento/protocolo/wsdl/proxyservice/ProtocoloWSDL12V3_0"/>
      <con:port>
        <con:name>ProtocoloPort12</con:name>
        <con:namespace>http://www.netservicos.com.br/Protocolo</con:namespace>
      </con:port>
      <con:selector type="SOAP body">
        <con:mapping operation="gerar" value=""/>
      </con:selector>
    </ser:binding>
    <ser:monitoring isEnabled="true">
      <ser:aggregationInterval>10</ser:aggregationInterval>
    </ser:monitoring>
    <ser:reporting>false</ser:reporting>
    <ser:logging isEnabled="false">
      <ser:logLevel>info</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="false">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="false">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
    <ser:throttling enabled="false">
      <ser:capacity>0</ser:capacity>
      <ser:maxQueueLength>0</ser:maxQueueLength>
      <ser:timeToLive>0</ser:timeToLive>
    </ser:throttling>
  </ser:coreEntry>
  <ser:endpointConfig xmlns:ser="http://www.bea.com/wli/sb/services">
    <tran:provider-id xmlns:tran="http://www.bea.com/wli/sb/transports">http</tran:provider-id>
    <tran:inbound xmlns:tran="http://www.bea.com/wli/sb/transports">true</tran:inbound>
    <tran:URI xmlns:tran="http://www.bea.com/wli/sb/transports">
      <env:value xmlns:env="http://www.bea.com/wli/config/env">/relacionar/atendimento/protocolo/Protocolo12V3</env:value>
    </tran:URI>
    <tran:inbound-properties xmlns:tran="http://www.bea.com/wli/sb/transports"/>
    <tran:all-headers xmlns:tran="http://www.bea.com/wli/sb/transports">false</tran:all-headers>
    <tran:user-header xmlns:tran="http://www.bea.com/wli/sb/transports">Authorization</tran:user-header><tran:provider-specific xmlns:tran="http://www.bea.com/wli/sb/transports"><http:inbound-properties><http:client-authentication xsi:type="http:HttpBasicAuthenticationType"/></http:inbound-properties><http:dispatch-policy>GerarProtocolo-WorkManager</http:dispatch-policy></tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-3620344986528488363-33e777c2.12fc14d4699.-7fbb" xmlns:ser="http://www.bea.com/wli/sb/services">
    <con:pipeline type="request" name="Gerar Protocolo de Atendimento_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Tratar Header">
        <con:comment>Estágio que realiza o tratamento do NetHeader.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/v2/NetHeader" prefix="netheader" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-8000</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
            <con1:message>LOG INICIAL - PROTOCOLO12V3</con1:message>
          </con1:log>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7fff</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - ENTRADA TRATAR HEADER</con1:message>
          </con1:log>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f41</con2:id>
            <con1:logLevel>debug</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
            <con1:message>Dados de Entrada</con1:message>
          </con1:log>
          <con1:replace varName="header" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-9112854788018405797-6aaec69f.12fc1409c4c.-8000</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/transformation/TransformarNetHeaderDefaults"/>
                <con2:param name="tokenDefault">
                  <con2:path>fn-bea:uuid()</con2:path>
                </con2:param>
                <con2:param name="numeroProtocoloDefault">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="netHeaderIN">
                  <con2:path>$header//netheader:NetHeader</con2:path>
                </con2:param>
                <con2:param name="aplicacaoDefault">
                  <con2:path>'OTHER'</con2:path>
                </con2:param>
                <con2:param name="funcionalidadeDefault">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="versaoServicoDefault">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="usernameDefault">
                  <con2:path>'ANONYMOUS'</con2:path>
                </con2:param>
                <con2:param name="numeroChamadaDefault">
                  <con2:path>''</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:replace>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ffe</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - SAIDA TRATAR HEADER</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="Validar campos obrigatórios" errorHandler="_onErrorHandler-5843420041123265949-7935325b.12fde9eb94d.-7fdb">
        <con:comment>Estágio que realiza a validação dos campos obrigatórios.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prot" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ffd</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - ENTRADA VALIDAR CAMPOS OBRIGATORIOS</con1:message>
          </con1:log>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7fe3</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(fn:not($body/prot:gerarRequest/prot:identificadorMotivo/node())) or data($body/prot:gerarRequest/prot:identificadorMotivo)eq ''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="localValidationMessages">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f8d</con2:id>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<excephdlr:validationMessages>
	<validationMessage>
		<code>ESB-ATEND-0012</code>
		<message>Campo {0} é Obrigatório.</message>
	</validationMessage>
</excephdlr:validationMessages>]]></con2:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:assign varName="campo">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f8c</con2:id>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'IdentificadorMotivo'</con2:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con1:Error>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f8b</con2:id>
                  <con1:errCode>ESB-ATEND-0012</con1:errCode>
                  <con1:message>Campo {0} é Obrigatório.</con1:message>
                </con1:Error>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ffc</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - SAIDA VALIDAR CAMPOS OBRIGATORIOS</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="Serviço externo de Identificação da base" errorHandler="_onErrorHandler-3620344986528488363-33e777c2.12fc14d4699.-7fc0">
        <con:comment>Estágio que realiza a chamada ao serviço externo de Identificação da base.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="trans" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prot" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ffb</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - ENTRADA SERVICO EXTERNO DE IDENTIFICACAO DA BASE</con1:message>
          </con1:log>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7ff0</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($body/prot:gerarRequest/prot:identificacaoContrato/iden:Contrato/iden:NumeroContrato/node()) and data($body/prot:gerarRequest/prot:identificacaoContrato/iden:Contrato/iden:NumeroContrato) != ''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fc5</con2:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="general/NETSMSDatabaseConfig/proxyservice/TransformaIdentificacaoContrato12V1" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>transformaIdentificacaoContrato</con1:operation>
                  <con1:request>
                    <con1:body>$transformaIdentificacaoContratoRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>transformaIdentificacaoContratoResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="transformaIdentificacaoContratoRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fc4</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<iden:IdentificacaoContrato xmlns:iden="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato">
    <iden:SmartCard>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:SmartCard)}</iden:SmartCard>
    <iden:Contrato>
        <iden:NumeroContrato>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:Contrato/iden:NumeroContrato)}</iden:NumeroContrato>
        <iden:CodigoOperadora>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:Contrato/iden:CodigoOperadora)}</iden:CodigoOperadora>
        <iden:IdentificacaoCidade>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:Contrato/iden:IdentificacaoCidade)}</iden:IdentificacaoCidade>
    </iden:Contrato>
    <iden:Protocolo>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:Protocolo)}</iden:Protocolo>
    <iden:EnderecoMAC>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:EnderecoMAC)}</iden:EnderecoMAC>
</iden:IdentificacaoContrato>]]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f85</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoContratoRequest</con3:xqueryText>
                      </con2:expr>
                      <con2:message>transformaIdentificacaoContratoRequest</con2:message>
                    </con2:log>
                  </con1:requestTransform>
                  <con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f85</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoContratoResponse</con3:xqueryText></con2:expr>
                      <con2:message>transformaIdentificacaoContratoResponse</con2:message>
                    </con2:log><con1:transport-headers><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3927230941413421401--79b75fda.17ee58a10f3.-7ff8</con2:id><con1:header-set>inbound-response</con1:header-set><con1:header name="SOA-Base" value="expression"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoContratoResponse/trans:AliasDatabase)</con2:xqueryText></con1:header></con1:transport-headers></con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ffa</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - SAIDA SERVICO EXTERNO DE IDENTIFICACAO DA BASE</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="Serviço externo de Identificação da Porposta" errorHandler="_onErrorHandler-1094426441919171170--48fbb288.149cfda8dc2.-7ff2">
        <con:comment>Estágio que realiza a chamada ao serviço externo de Identificação do Proposta</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoProposta12V1" prefix="trans" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prot" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoProposta" prefix="iden1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ff9</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - ENTRADA SERVICO EXTERNO DE IDENTIFICACAO DA PROPOSTA</con1:message>
          </con1:log>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7fec</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($body/prot:gerarRequest/prot:identificacaoProposta/iden1:Proposta/iden1:NumeroProposta/node()) and data($body/prot:gerarRequest/prot:identificacaoProposta/iden1:Proposta/iden1:NumeroProposta) != ''</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7ff9</con2:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="general/NETSMSDatabaseConfig/proxyservice/TransformaIdentificacaoProposta12V1" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>transformaIdentificacaoProposta</con1:operation>
                  <con1:request>
                    <con1:body>$transformaIdentificacaoPropostaRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>transformaIdentificacaoPropostaResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="transformaIdentificacaoPropostaRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fc4</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<iden1:IdentificacaoProposta xmlns:iden1="http://www.netservicos.com.br/modelocanonico/v2/identificacaoProposta">
    <iden1:Proposta>
        <iden1:NumeroProposta>{data($body/prot:gerarRequest/prot:identificacaoProposta/iden1:Proposta/iden1:NumeroProposta)}</iden1:NumeroProposta>
        <iden1:CodigoOperadora>{data($body/prot:gerarRequest/prot:identificacaoProposta/iden1:Proposta/iden1:CodigoOperadora)}</iden1:CodigoOperadora>
        <iden1:IdentificacaoCidade>{data($body/prot:gerarRequest/prot:identificacaoProposta/iden1:Proposta/iden1:IdentificacaoCidade)}</iden1:IdentificacaoCidade>
    </iden1:Proposta>
</iden1:IdentificacaoProposta>]]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f85</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoContratoRequest</con3:xqueryText>
                      </con2:expr>
                      <con2:message>transformaIdentificacaoContratoRequest</con2:message>
                    </con2:log>
                  </con1:requestTransform>
                  <con1:responseTransform><con1:transport-headers><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4082707715677982436-a50f066.17f088ae3f8.-8000</con2:id><con1:header-set>inbound-response</con1:header-set><con1:header name="SOA-Base" value="expression"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoPropostaResponse/trans:AliasDatabase)</con2:xqueryText></con1:header></con1:transport-headers><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f85</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoPropostaResponse</con3:xqueryText></con2:expr>
                      <con2:message>transformaIdentificacaoPropostaResponse</con2:message>
                    </con2:log></con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ff8</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - SAIDA SERVICO EXTERNO DE IDENTIFICACAO DA PROPOSTA</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
      <con:stage name="Chamada ao EJB" errorHandler="_onErrorHandler-3620344986528488363-33e777c2.12fc14d4699.-7f7c">
        <con:comment>Estágio que realiza a chamada do EJB que gera o número de protocolo de atendimento.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoProposta12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.openuri.org/" prefix="ns2" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prot" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoProposta" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ff7</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - ENTRADA CHAMADA AO EJB</con1:message>
          </con1:log>
          <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f81</con2:id>
            <con1:service xsi:type="ref:BusinessServiceRef" ref="relacionar/atendimento/protocolo/businessservice/ProtocoloUnicoServiceEJBBSV3_0" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>gerarProtocoloAtendimento</con1:operation>
            <con1:request>
              <con1:body>$gerarProtocoloAtendimentoRequest</con1:body>
            </con1:request>
            <con1:response>
              <con1:body>gerarProtocoloAtendimentoResponse</con1:body>
            </con1:response>
            <con1:requestTransform>
              <con1:ifThenElse>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-202044905730728479-5d90f9bf.149f7b4a37f.-7fd2</con2:id>
                <con1:case>
                  <con1:condition>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:NumeroContrato/node()) and data($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:NumeroContrato) ne ''</con2:xqueryText>
                  </con1:condition>
                  <con1:actions>
                    <con1:transport-headers>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f80</con2:id>
                      <con1:header-set>outbound-request</con1:header-set>
                      <con1:header name="j_identity_base" value="expression">
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoContratoResponse/tran1:AliasDatabase)</con2:xqueryText>
                      </con1:header>
                    </con1:transport-headers>
                    <con1:assign varName="gerarProtocoloAtendimentoRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-8000</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ns2:gerarProtocoloAtendimento xmlns:iden="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato">
    <ns2:numProposta>0</ns2:numProposta>
    {
    	if( exists($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:NumeroContrato/node()) and data($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:NumeroContrato) ne '' ) then
			<ns2:numContrato>{data($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:NumeroContrato)}</ns2:numContrato>
    	else(
    		<ns2:numContrato>0</ns2:numContrato>
    	)
    }
    <ns2:codOperadora>{data($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:CodigoOperadora)}</ns2:codOperadora>
    <ns2:protocolo>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:Protocolo)}</ns2:protocolo>
    <ns2:idMotivoChamada>{data($body/prot:gerarRequest/prot:identificadorMotivo)}</ns2:idMotivoChamada>
</ns2:gerarProtocoloAtendimento>]]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:actions>
                </con1:case>
                <con1:default>
                  <con1:transport-headers>
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f80</con2:id>
                    <con1:header-set>outbound-request</con1:header-set>
                    <con1:header name="j_identity_base" value="expression">
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoPropostaResponse/tran:AliasDatabase)</con2:xqueryText>
                    </con1:header>
                  </con1:transport-headers>
                  <con1:assign varName="gerarProtocoloAtendimentoRequest">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-8000</con2:id>
                    <con1:expr>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ns2:gerarProtocoloAtendimento xmlns:iden="http://www.netservicos.com.br/modelocanonico/v2/identificacaoProposta">
    {
    	if( exists($transformaIdentificacaoPropostaResponse/tran:Proposta/tran:NumeroProposta/node()) and data($transformaIdentificacaoPropostaResponse/tran:Proposta/tran:NumeroProposta) ne '' ) then
			<ns2:numProposta>{data($transformaIdentificacaoPropostaResponse/tran:Proposta/tran:NumeroProposta)}</ns2:numProposta>    	
    	else(
    		<ns2:numProposta>0</ns2:numProposta>
    	)
    }
    <ns2:numContrato>0</ns2:numContrato>
    <ns2:codOperadora>{data($transformaIdentificacaoPropostaResponse/tran:Proposta/tran:CodigoOperadora)}</ns2:codOperadora>
    <ns2:protocolo>{data($body/prot:gerarRequest/prot:identificacaoContrato/iden:Protocolo)}</ns2:protocolo>
    <ns2:idMotivoChamada>{data($body/prot:gerarRequest/prot:identificadorMotivo)}</ns2:idMotivoChamada>
</ns2:gerarProtocoloAtendimento>]]></con2:xqueryText>
                    </con1:expr>
                  </con1:assign>
                </con1:default>
              </con1:ifThenElse>
              <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f7e</con3:id>
                <con2:logLevel>debug</con2:logLevel>
                <con2:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$gerarProtocoloAtendimentoRequest</con3:xqueryText>
                </con2:expr>
                <con2:message>gerarProtocoloAtendimentoRequest</con2:message>
              </con2:log>
            </con1:requestTransform>
            <con1:responseTransform>
              <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f7d</con3:id>
                <con2:logLevel>debug</con2:logLevel>
                <con2:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$gerarProtocoloAtendimentoResponse</con3:xqueryText>
                </con2:expr>
                <con2:message>gerarProtocoloAtendimentoResponse</con2:message>
              </con2:log>
              <con1:ifThenElse>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f75</con2:id>
                <con1:case>
                  <con1:condition>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:empty($gerarProtocoloAtendimentoResponse)</con2:xqueryText>
                  </con1:condition>
                  <con1:actions/>
                </con1:case>
                <con1:default>
                  <con1:assign varName="gerarResponse">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f74</con2:id>
                    <con1:expr>
                      <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:resource ref="relacionar/atendimento/protocolo/transformation/TransformarResponseEJBXGerarResponseXQuery"/>
                        <con2:param name="gerarProtocoloAtendimentoResponse1">
                          <con2:path>$gerarProtocoloAtendimentoResponse</con2:path>
                        </con2:param>
                      </con2:xqueryTransform>
                    </con1:expr>
                  </con1:assign>
                </con1:default>
              </con1:ifThenElse>
            </con1:responseTransform>
          </con1:wsCallout>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ff6</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
            </con1:expr>
            <con1:message>PROTOCOLO12V3 - SAIDA CHAMADA AO EJB</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
    <con:stage name="Chamada Envio Protocolo Fila" errorHandler="_onErrorHandler-1585617897462662349--452742ef.17600be3987.-7fe2"><con:comment>Estágio que realiza a chamada ao servico que envia o número de protocolo para a fila de atendimento.</con:comment><con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoProposta12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/v2/NetHeader" prefix="net" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prot" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context><con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1585617897462662349--452742ef.17600be3987.-7ff1</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($body/prot:gerarRequest/prot:enviar/node()) and data($body/prot:gerarRequest/prot:enviar) = fn:true()</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-591947259097414406--210fe9c3.15e3bc6ef68.-7fca</con2:id><con1:service xsi:type="ref:ProxyRef" ref="relacionar/atendimento/protocolo/proxyservice/EnvioProtocoloFila12V1" xmlns:ref="http://www.bea.com/wli/sb/reference"/><con1:operation>envioProtocoloFila</con1:operation><con1:request><con1:body>$enviarProtocoloRequest</con1:body><con1:header>$enviarProtocoloHeaderRequest</con1:header></con1:request><con1:response><con1:body>enviarProtocoloResponse</con1:body><con1:header>enviarProtocoloHeaderResponse</con1:header></con1:response><con1:requestTransform><con1:transport-headers xmlns:tran="http://www.bea.com/wli/sb/transports"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7652611528383525848--360d57d0.1799eb6429c.-7ffc</con2:id><con1:header-set>outbound-request</con1:header-set><con1:header name="Authorization" value="expression"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$inbound/ctx:transport/ctx:request/tp:headers/tp:user-header/@value</con2:xqueryText></con1:header></con1:transport-headers><con1:ifThenElse><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-591947259097414406--210fe9c3.15e3bc6ef68.-7fc9</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:NumeroContrato/node()) and data($transformaIdentificacaoContratoResponse/tran1:Contrato/tran1:NumeroContrato) ne ''</con2:xqueryText></con1:condition><con1:actions><con1:transport-headers><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-591947259097414406--210fe9c3.15e3bc6ef68.-7fc8</con2:id><con1:header-set>outbound-request</con1:header-set><con1:header name="j_identity_base" value="expression"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoContratoResponse/tran1:AliasDatabase)</con2:xqueryText></con1:header></con1:transport-headers><con1:assign varName="aliasDatabase"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-591947259097414406--210fe9c3.15e3bc6ef68.-7fc4</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoContratoResponse/tran1:AliasDatabase)</con2:xqueryText></con1:expr></con1:assign></con1:actions></con1:case><con1:default><con1:transport-headers><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-591947259097414406--210fe9c3.15e3bc6ef68.-7fc7</con2:id><con1:header-set>outbound-request</con1:header-set><con1:header name="j_identity_base" value="expression"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoPropostaResponse/tran:AliasDatabase)</con2:xqueryText></con1:header></con1:transport-headers><con1:assign varName="aliasDatabase"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-591947259097414406--210fe9c3.15e3bc6ef68.-7fc3</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoPropostaResponse/tran:AliasDatabase)</con2:xqueryText></con1:expr></con1:assign></con1:default></con1:ifThenElse><con1:assign varName="enviarProtocoloRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-591947259097414406--210fe9c3.15e3bc6ef68.-7fc6</con2:id><con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="relacionar/atendimento/protocolo/transformation/TransformaProtocoloResponseXEnvioProtocoloFilaRequestXQuery"/><con2:param name="aliasDatabase"><con2:path>$aliasDatabase</con2:path></con2:param><con2:param name="gerarResponse1"><con2:path>$gerarResponse</con2:path></con2:param><con2:param name="gerarRequest1"><con2:path>$body/prot:gerarRequest</con2:path></con2:param></con2:xqueryTransform></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1762539881298936216--781a6989.15e3e7987f3.-7fc5</con3:id><con2:logLevel>info</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$enviarProtocoloRequest</con3:xqueryText></con2:expr><con2:message>enviarProtocoloRequest</con2:message></con2:log><con1:assign varName="enviarProtocoloHeaderRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1762539881298936216--781a6989.15e3e7987f3.-7fc3</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<soap12-env:Header>
	<net:NetHeader>
         <aplicacao></aplicacao>
         <funcionalidade></funcionalidade>
         <versaoServico></versaoServico>
         <token></token>
         <atendimento>
            <numeroProtocolo></numeroProtocolo>
            <numeroChamada></numeroChamada>
         </atendimento>
         <username></username>
    </net:NetHeader>
</soap12-env:Header>]]></con2:xqueryText></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1762539881298936216--781a6989.15e3e7987f3.-7fc2</con3:id><con2:logLevel>info</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$enviarProtocoloHeaderRequest</con3:xqueryText></con2:expr><con2:message>enviarProtocoloHeaderRequest</con2:message></con2:log></con1:requestTransform><con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1762539881298936216--781a6989.15e3e7987f3.-7fc0</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$enviarProtocoloResponse</con3:xqueryText></con2:expr><con2:message>enviarProtocoloResponse</con2:message></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1762539881298936216--781a6989.15e3e7987f3.-7fc1</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$enviarProtocoloHeaderResponse</con3:xqueryText></con2:expr><con2:message>enviarProtocoloHeaderResponse</con2:message></con2:log></con1:responseTransform></con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions></con:stage></con:pipeline>
    <con:pipeline type="response" name="Gerar Protocolo de Atendimento_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Retorno ao cliente">
        <con:comment>Estágio que realiza o tratamento do retorno antes de ser enviado ao cliente.</con:comment>
        <con:context>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prot" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7ffa</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;soap12-env:Header/></con2:xqueryText>
            </con1:expr>
          </con1:replace>
          <con1:replace contents-only="false" varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f73</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;soap12-env:Body>
	{$gerarResponse}
&lt;/soap12-env:Body></con2:xqueryText>
            </con1:expr>
          </con1:replace>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f72</con2:id>
            <con1:logLevel>debug</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$gerarResponse</con2:xqueryText>
            </con1:expr>
            <con1:message>Resposta ao Cliente</con1:message>
          </con1:log>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7770734398168503378--2c737d03.160db997da3.-7ff5</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
            <con1:message>LOG FINAL - PROTOCOLO12V3</con1:message>
          </con1:log>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-3620344986528488363-33e777c2.12fc14d4699.-7fc0" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Tratamento de erro do serviço de identificação da base">
        <con:comment>Tratamento de erro de acesso ao serviço externo de identificação da base.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f84</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro ao identificar a base</con1:message>
          </con1:log>
          <con1:assign varName="localMessageParameters" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7ffb</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>     
      &lt;logging:value>{'Transforma Identificação Contrato'}&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorHandlerRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fbd</con2:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                <con2:param name="additionalInformation">
                  <con2:path>$null</con2:path>
                </con2:param>
                <con2:param name="currentFault">
                  <con2:path>$fault</con2:path>
                </con2:param>
                <con2:param name="exceptionStackTrace">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="accessResourceName">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="responseSOAPVersion">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="currentBody">
                  <con2:path>$body</con2:path>
                </con2:param>
                <con2:param name="exceptionClassification">
                  <con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path>
                </con2:param>
                <con2:param name="messageParameters">
                  <con2:path>$localMessageParameters</con2:path>
                </con2:param>
                <con2:param name="processo">
                  <con2:path>'atendimento'</con2:path>
                </con2:param>
                <con2:param name="macroProcesso">
                  <con2:path>'RELACIONAR'</con2:path>
                </con2:param>
                <con2:param name="callResponse">
                  <con2:path>$transformaIdentificacaoContratoResponse</con2:path>
                </con2:param>
                <con2:param name="validationMessages">
                  <con2:path>&lt;validationMessages/></con2:path>
                </con2:param>
                <con2:param name="messageCode">
                  <con2:path>'ESB-ATEND-0015'</con2:path>
                </con2:param>
                <con2:param name="currentInbound">
                  <con2:path>$inbound</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fbc</con2:id>
            <con1:errCode>LOCAL_EXCEPTION</con1:errCode>
          </con1:Error>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-3620344986528488363-33e777c2.12fc14d4699.-7fbb" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Error Handler Proxy12">
        <con:comment>Estágio que realiza o tratamento de erro global do Proxy12.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/errorinfo" prefix="errorInfo" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="log" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/v2/NetHeader" prefix="net" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://netservicos.com.br/core/schema" prefix="sch" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f3f</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro no proxy Protocolo12V2</con1:message>
          </con1:log>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fad</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">empty($errorHandlerRequest)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:assign varName="errorHandlerRequest">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6380375213007342941-5017d7f9.126fc89df41.-7ff6</con2:id>
                  <con1:expr>
                    <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                      <con2:param name="additionalInformation">
                        <con2:path>$null</con2:path>
                      </con2:param>
                      <con2:param name="currentFault">
                        <con2:path>$fault</con2:path>
                      </con2:param>
                      <con2:param name="exceptionStackTrace">
                        <con2:path>''</con2:path>
                      </con2:param>
                      <con2:param name="accessResourceName">
                        <con2:path>''</con2:path>
                      </con2:param>
                      <con2:param name="responseSOAPVersion">
                        <con2:path>'1.2'</con2:path>
                      </con2:param>
                      <con2:param name="currentBody">
                        <con2:path>$body</con2:path>
                      </con2:param>
                      <con2:param name="exceptionClassification">
                        <con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path>
                      </con2:param>
                      <con2:param name="messageParameters">
                        <con2:path>$null</con2:path>
                      </con2:param>
                      <con2:param name="processo">
                        <con2:path>'atendimento'</con2:path>
                      </con2:param>
                      <con2:param name="macroProcesso">
                        <con2:path>'RELACIONAR'</con2:path>
                      </con2:param>
                      <con2:param name="callResponse">
                        <con2:path>$null</con2:path>
                      </con2:param>
                      <con2:param name="validationMessages">
                        <con2:path>&lt;validationMessages/></con2:path>
                      </con2:param>
                      <con2:param name="messageCode">
                        <con2:path>$errorHandlerResponse/ctx:fault</con2:path>
                      </con2:param>
                      <con2:param name="currentInbound">
                        <con2:path>$inbound</con2:path>
                      </con2:param>
                    </con2:xqueryTransform>
                  </con1:expr>
                </con1:assign>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
          <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fab</con2:id>
            <con1:service xsi:type="ref:ProxyRef" ref="general/NETESBExceptionHandler/proxyservice/NETESBExceptionHandler12V1" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con1:operation>convertLocalExceptionToFault</con1:operation>
            <con1:request>
              <con1:body>$errorHandlerRequest</con1:body>
            </con1:request>
            <con1:response>
              <con1:body>errorHandlerResponse</con1:body>
            </con1:response>
            <con1:requestTransform>
              <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f3e</con3:id>
                <con2:logLevel>debug</con2:logLevel>
                <con2:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$errorHandlerRequest</con3:xqueryText>
                </con2:expr>
                <con2:message>errorHandlerRequest</con2:message>
              </con2:log>
            </con1:requestTransform>
            <con1:responseTransform>
              <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f3d</con3:id>
                <con2:logLevel>debug</con2:logLevel>
                <con2:expr>
                  <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$errorHandlerResponse</con3:xqueryText>
                </con2:expr>
                <con2:message>errorHandlerResponse</con2:message>
              </con2:log>
            </con1:responseTransform>
          </con1:wsCallout>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7faa</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">($inbound//ctx:transport/ctx:request/http:client-host/node() and
$inbound//ctx:transport/ctx:request/http:client-host ne "")
or
($inbound//ctx:transport/ctx:request/http:client-address/node() and 
$inbound//ctx:transport/ctx/request/http:client-address ne "")</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f3c</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:message>Chamada Externa, gerar Log e Alerta Protocolo12V2</con2:message>
                </con2:log>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8236716223753113906-54132874.1265b792ae0.-7fed</con2:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="general/NETLog/proxyservice/FormatLogMessage12" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>formatLogMessage</con1:operation>
                  <con1:request>
                    <con1:body>$formatLogMessageRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>formatLogMessageResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="formatLogMessageRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8236716223753113906-54132874.1265b792ae0.-7fec</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<for:logMessage xmlns:log="http://www.netservicos.com.br/modelocanonico/v2/logging" xmlns:for="http://www.netservicos.com.br/FormatLogMessage">
	<log:transactionId>{fn:data($header//token)}</log:transactionId>
	<log:logType>ERROR</log:logType>
	<log:messageCode>{data($errorHandlerRequest/excephdlr:currentFault/ctx:fault/ctx:errorCode)}</log:messageCode>
	<log:messageParameters/>
	<log:username>{fn:data($inbound/ctx:security/ctx:transportClient/ctx:username/text())}</log:username>
	<log:timestamp>{fn:data(fn:current-dateTime())}</log:timestamp>
	<log:errorInfo>
		{$errorHandlerResponse//errorInfo:ErrorInfo/@*,$errorHandlerResponse//errorInfo:ErrorInfo/node()}
	</log:errorInfo>
	<log:macroProcesso>{"RELACIONAR"}</log:macroProcesso>
	<log:processo>{"atendimento"}</log:processo>
	<log:consumidor>{"NÃO INFORMADO"}</log:consumidor>
	<log:funcionalidade>{"NÃO INFORMADO"}</log:funcionalidade>
</for:logMessage>]]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f3b</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$formatLogMessageRequest</con3:xqueryText>
                      </con2:expr>
                      <con2:message>formatLogMessageRequest</con2:message>
                    </con2:log>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f3a</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$formatLogMessageResponse</con3:xqueryText>
                      </con2:expr>
                      <con2:message>formatLogMessageResponse</con2:message>
                    </con2:log>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8236716223753113906-54132874.1265b792ae0.-7fe8</con2:id>
                  <con1:service xsi:type="ref:ProxyRef" ref="general/NETAlert/proxyservice/Alert12" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>alert</con1:operation>
                  <con1:request>
                    <con1:body>$alertRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>alertResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="alertRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8236716223753113906-54132874.1265b792ae0.-7fe6</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<aler1:alert xmlns:aler="http://www.netservicos.com.br/modelocanonico/v2/alert" xmlns:aler1="http://www.netservicos.com.br/Alert">
    <aler:timestamp>{fn:data(fn:current-dateTime())}</aler:timestamp>
    <aler:transactionId>{data($header//token)}</aler:transactionId>
    <aler:message>{fn:data($formatLogMessageResponse/logging:message)}</aler:message>
    <aler:serviceSeverityLevel>NIVEL1</aler:serviceSeverityLevel>
    <aler:consumidor>{"NAO_INFORMADO"}</aler:consumidor>
    <aler:macroProcesso>RELACIONAR</aler:macroProcesso>
    <aler:macroProcessoNivel>atendimento</aler:macroProcessoNivel>
    <aler:macroProcessoSubNivel/>
    <aler:exceptionClassification>{data($errorHandlerResponse//errorInfo:ErrorInfo/exceptionClassification)}</aler:exceptionClassification>
</aler1:alert>]]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f39</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$alertRequest</con3:xqueryText>
                      </con2:expr>
                      <con2:message>alertRequest</con2:message>
                    </con2:log>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f38</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$alertResponse</con3:xqueryText>
                      </con2:expr>
                      <con2:message>alertResponse</con2:message>
                    </con2:log>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6380375213007342941-5017d7f9.126fc89df41.-7fe9</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($errorHandlerResponse/soap12-env:Fault)</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:replace varName="body" contents-only="true">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6380375213007342941-5017d7f9.126fc89df41.-7fea</con2:id>
                        <con1:location>
                          <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$errorHandlerResponse/soap12-env:Fault</con2:xqueryText>
                        </con1:expr>
                      </con1:replace>
                    </con1:actions>
                  </con1:case>
                  <con1:default>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6380375213007342941-5017d7f9.126fc89df41.-7fe7</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$errorHandlerResponse/soap-env:Fault</con2:xqueryText>
                      </con1:expr>
                    </con1:replace>
                  </con1:default>
                </con1:ifThenElse>
          

                <con1:ifThenElse><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2200672819673162128--307c079d.1756f86f1cc.-8000</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:contains($fault, "ORA-") or
fn:contains($body, "ORA-")</con2:xqueryText></con1:condition><con1:actions><con1:transport-headers>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8860558302490276716--75ff3585.1699161cd2f.-8000</con2:id>
            <con1:header-set>inbound-response</con1:header-set>
            <con1:header value="expression" name="SOA-Code">
              
	        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="general/transformation/FormatTransportHeaderResponseORAErrorXQTv1"/><con2:param name="fault"><con2:path>$fault</con2:path></con2:param><con2:param name="body"><con2:path>$body</con2:path></con2:param></con2:xqueryTransform></con1:header>
          </con1:transport-headers></con1:actions></con1:case><con1:default><con1:transport-headers>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8860558302490276716--75ff3585.1699161cd2f.-8000</con2:id>
            <con1:header-set>inbound-response</con1:header-set>
            <con1:header name="SOA-Code" value="expression">
              
	        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="general/transformation/FormatTransportHeaderResponseCodeXQTv1"/><con2:param name="fault"><con2:path>$fault</con2:path></con2:param><con2:param name="body"><con2:path>$body</con2:path></con2:param></con2:xqueryTransform></con1:header>
          </con1:transport-headers></con1:default></con1:ifThenElse><con2:reply isError="true" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                  <con2:id>_ActionId-6380375213007342941-5017d7f9.126fc89df41.-7fe5</con2:id>
                </con2:reply>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f37</con3:id>
                <con2:logLevel>debug</con2:logLevel>
                <con2:message>Chamada Interna Protocolo12V2</con2:message>
              </con2:log>
              <con1:replace varName="fault" contents-only="false">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6380375213007342941-5017d7f9.126fc89df41.-7fe4</con2:id>
                <con1:location>
                  <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                </con1:location>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$errorHandlerResponse/ctx:fault</con2:xqueryText>
                </con1:expr>
              </con1:replace>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-3620344986528488363-33e777c2.12fc14d4699.-7f7c" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Tratamento de erro ao acessar EJB">
        <con:comment>Tratamento de erro ao acessar EJB que realiza a geração o número de protocolo de atendimento.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f7b</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro ao gerar protocolo</con1:message>
          </con1:log>
          <con1:assign varName="localMessageParameters" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7ffd</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>
	&lt;logging:value>{'ProtocoloUnicoServiceEJB'}&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorHandlerRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6886531341387225846-239eebb6.127d99694f3.-7fdd</con2:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                <con2:param name="additionalInformation">
                  <con2:path>$null</con2:path>
                </con2:param>
                <con2:param name="currentFault">
                  <con2:path>$fault</con2:path>
                </con2:param>
                <con2:param name="exceptionStackTrace">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="accessResourceName">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="responseSOAPVersion">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="currentBody">
                  <con2:path>$body</con2:path>
                </con2:param>
                <con2:param name="exceptionClassification">
                  <con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path>
                </con2:param>
                <con2:param name="messageParameters">
                  <con2:path>$localMessageParameters</con2:path>
                </con2:param>
                <con2:param name="processo">
                  <con2:path>'atendimento'</con2:path>
                </con2:param>
                <con2:param name="macroProcesso">
                  <con2:path>'RELACIONAR'</con2:path>
                </con2:param>
                <con2:param name="callResponse">
                  <con2:path>$gerarResponse</con2:path>
                </con2:param>
                <con2:param name="validationMessages">
                  <con2:path>&lt;validationMessages/></con2:path>
                </con2:param>
                <con2:param name="messageCode">
                  <con2:path>'ESB-ATEND-0015'</con2:path>
                </con2:param>
                <con2:param name="currentInbound">
                  <con2:path>$inbound</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f76</con2:id>
            <con1:errCode>LOCAL_EXCEPTION</con1:errCode>
          </con1:Error>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline name="_onErrorHandler-5843420041123265949-7935325b.12fde9eb94d.-7fdb" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Tratamento de erro dos campos obrigatórios">
        <con:comment>Estágio que realiza o tratamento de erros quando um campo obrigatório não foi passado no request o serviço.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7fdf</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro na validação de campos obrigatórios</con1:message>
          </con1:log>
          <con1:assign varName="localMessageParameters" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7fde</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>
	&lt;logging:value>{$campo}&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorHandlerRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7fdd</con2:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                <con2:param name="additionalInformation">
                  <con2:path>$null</con2:path>
                </con2:param>
                <con2:param name="currentFault">
                  <con2:path>$fault</con2:path>
                </con2:param>
                <con2:param name="exceptionStackTrace">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="accessResourceName">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="responseSOAPVersion">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="currentBody">
                  <con2:path>$body</con2:path>
                </con2:param>
                <con2:param name="exceptionClassification">
                  <con2:path>'CLASSIFICATION_VALIDATION'</con2:path>
                </con2:param>
                <con2:param name="processo">
                  <con2:path>'atendimento'</con2:path>
                </con2:param>
                <con2:param name="messageParameters">
                  <con2:path>$localMessageParameters</con2:path>
                </con2:param>
                <con2:param name="macroProcesso">
                  <con2:path>'RELACIONAR'</con2:path>
                </con2:param>
                <con2:param name="callResponse">
                  <con2:path>$transformarIdentificacaoContratoResponse</con2:path>
                </con2:param>
                <con2:param name="validationMessages">
                  <con2:path>&lt;validationMessages/></con2:path>
                </con2:param>
                <con2:param name="messageCode">
                  <con2:path>'ESB-ATEND-0012'</con2:path>
                </con2:param>
                <con2:param name="currentInbound">
                  <con2:path>$inbound</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5843420041123265949-7935325b.12fde9eb94d.-7fdc</con2:id>
            <con1:errCode>LOCAL_EXCEPTION</con1:errCode>
          </con1:Error>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline name="_onErrorHandler-1094426441919171170--48fbb288.149cfda8dc2.-7ff2" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Tratamento de erro do serviço de identificação da proposta">
        <con:comment>Tratamento de erro de acesso ao serviço externo de identificação da proposta</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7ff6</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro ao identificar a proposta</con1:message>
          </con1:log>
          <con1:assign varName="localMessageParameters" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7ff5</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>     
      &lt;logging:value>{'Transforma Identificação Proposta'}&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorHandlerRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7ff4</con2:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                <con2:param name="additionalInformation">
                  <con2:path>$null</con2:path>
                </con2:param>
                <con2:param name="currentFault">
                  <con2:path>$fault</con2:path>
                </con2:param>
                <con2:param name="exceptionStackTrace">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="accessResourceName">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="responseSOAPVersion">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="currentBody">
                  <con2:path>$body</con2:path>
                </con2:param>
                <con2:param name="exceptionClassification">
                  <con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path>
                </con2:param>
                <con2:param name="messageParameters">
                  <con2:path>$localMessageParameters</con2:path>
                </con2:param>
                <con2:param name="processo">
                  <con2:path>'atendimento'</con2:path>
                </con2:param>
                <con2:param name="macroProcesso">
                  <con2:path>'RELACIONAR'</con2:path>
                </con2:param>
                <con2:param name="callResponse">
                  <con2:path>$transformaIdentificacaoPropostaResponse</con2:path>
                </con2:param>
                <con2:param name="validationMessages">
                  <con2:path>&lt;validationMessages/></con2:path>
                </con2:param>
                <con2:param name="messageCode">
                  <con2:path>'ESB-ATEND-0015'</con2:path>
                </con2:param>
                <con2:param name="currentInbound">
                  <con2:path>$inbound</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7ff3</con2:id>
            <con1:errCode>LOCAL_EXCEPTION</con1:errCode>
          </con1:Error>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline name="_onErrorHandler-1585617897462662349--452742ef.17600be3987.-7fe2" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Tratamento de erro envio protocolo">
        <con:comment>Tratamento de erro ao chamar serviço que realiza o envio do número de protocolo de atendimento.</con:comment><con:context/>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1585617897462662349--452742ef.17600be3987.-7fe4</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro ao enviar protocolo</con1:message>
          </con1:log>
        <con1:resume xmlns:con1="http://www.bea.com/wli/sb/stages/config"><con1:id>_ActionId-1585617897462662349--452742ef.17600be3987.-7fe3</con1:id></con1:resume></con:actions>
      </con:stage></con:pipeline><con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:branch-node type="operation" name="Protocolo">
        <con:comment>Proxy responsavel pela geração do protocolo</con:comment>
        <con:context/>
        <con:branch-table>
          <con:branch name="gerar">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="Gerar Protocolo de Atendimento">
                <con:comment>Pipeline responsavel pela geração do protocolo</con:comment>
                <con:request>Gerar Protocolo de Atendimento_request</con:request>
                <con:response>Gerar Protocolo de Atendimento_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:default-branch>
            <con:flow/>
          </con:default-branch>
        </con:branch-table>
      </con:branch-node>
    </con:flow>
  </ser:router>
</xml-fragment>