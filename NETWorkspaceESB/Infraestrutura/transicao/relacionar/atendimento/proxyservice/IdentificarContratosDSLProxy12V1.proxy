<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment>
  <ser:coreEntry isProxy="true" isEnabled="true" xmlns:ser="http://www.bea.com/wli/sb/services">
    <ser:description>Proxy Service responsável pela pequisa de contratos no DSP. As duas pesquisas, por documento e por telefone, foram construidas este proxy pela caracteristica do SPLIT JOIN.
Foi construido este proxy para evitar referencia ciclica e também por que o Split Join não consegue passar o NET Header na requisição.</ser:description>
    <ser:binding type="SOAP" isSoap12="true" xsi:type="con:SoapBindingType" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:wsdl ref="Infraestrutura/transicao/relacionar/atendimento/wsdl/proxy/ListarContratos"/><con:binding><con:name>listarContratosSOAP12</con:name><con:namespace>http://www.netservicos.com.br/ListarContratos/</con:namespace></con:binding><con:selector type="SOAP body"/></ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig xmlns:ser="http://www.bea.com/wli/sb/services">
    <tran:provider-id xmlns:tran="http://www.bea.com/wli/sb/transports">local</tran:provider-id>
    <tran:inbound xmlns:tran="http://www.bea.com/wli/sb/transports">true</tran:inbound>
    <tran:inbound-properties xmlns:tran="http://www.bea.com/wli/sb/transports"/>
    <tran:all-headers xmlns:tran="http://www.bea.com/wli/sb/transports">true</tran:all-headers>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-2350086241785725866--586e9d4.143ceda4ed5.-7fb3" xmlns:ser="http://www.bea.com/wli/sb/services">
    
    
    <con:pipeline type="error" name="_onErrorHandler-2350086241785725866--586e9d4.143ceda4ed5.-7fb3" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Tratamento de Erro Geral">
        <con:comment>Tratamento de Erro Geral do proxy Listar Contratos</con:comment>
        <con:context><con1:varNsDecl namespace="http://www.netservicos.com.br/ListarContratos/" prefix="lis" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2350086241785725866--586e9d4.143ceda4ed5.-7fb2</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>IDENTIFICAR CONTRATOS DSL PROXY (FAULT): TRATAMENTO DE ERRO GERAL</con1:message>
          </con1:log>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1832063074093532466--3513cfe8.156c2ae1505.-8000</con2:id><con1:logLevel>error</con1:logLevel><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText></con1:expr><con1:message>IDENTIFICAR CONTRATOS DSL PROXY (BODY): TRATAMENTO DE ERRO GERAL</con1:message></con1:log><con1:replace varName="body" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2248766588846812300--7daa30f7.143d37bce0d.-7fe1</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<soap12-env:Body>
	<soap12-env:Fault>
		<faultcode>{data($fault/ctx:errorCode)}</faultcode>
		<faultstring>{data($fault/ctx:reason)}</faultstring>
		<detail>
			{$fault}
		</detail>
	</soap12-env:Fault>
</soap12-env:Body>]]></con2:xqueryText></con1:expr>
          </con1:replace>
          <con1:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
            <con1:id>_ActionId-2248766588846812300--7daa30f7.143d37bce0d.-7fe0</con1:id>
          </con1:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    
    
    <con:pipeline type="request" name="Listar Contratos por Documento_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Consultar Contratos por Documento"><con:comment>Consultar Contratos por Documento</con:comment><con:context><con1:varNsDecl namespace="http://www.netservicos.com.br/ListarContratos/" prefix="lis" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context><con:actions><con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-8000</con2:id><con1:logLevel>debug</con1:logLevel><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText></con1:expr><con1:message>Consultar Contratos por Documento</con1:message></con1:log><con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fff</con2:id><con1:service xsi:type="ref:BusinessServiceRef" ref="Infraestrutura/transicao/relacionar/atendimento/businessservice/ConsultarContratoAssinanteBS" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/><con1:operation>identificarContratosPorDocumento</con1:operation><con1:request><con1:body>$identificarContratosPorDocumentoRequest</con1:body></con1:request><con1:response><con1:body>identificarContratosPorDocumentoResponse</con1:body></con1:response><con1:requestTransform><con1:assign varName="identificarContratosPorDocumentoRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ffe</con2:id><con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="Infraestrutura/transicao/relacionar/atendimento/transformation/IdentificarContratoPorDocumentoRequestXQuery"/><con2:param name="listarContratosPorDocumentoRequest1"><con2:path>$body/lis:listarContratosPorDocumentoRequest</con2:path></con2:param></con2:xqueryTransform></con1:expr></con1:assign><con1:transport-headers copy-all="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ffd</con2:id><con1:header-set>outbound-request</con1:header-set><con1:header value="expression" name="j_identity_base"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/lis:listarContratosPorDocumentoRequest/base)</con2:xqueryText></con1:header></con1:transport-headers><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2306531023829884598--2905fcc2.14639734c81.-8000</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($body/lis:listarContratosPorDocumentoRequest/base)</con3:xqueryText></con2:expr><con2:message>j_identy_base</con2:message></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ffc</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$identificarContratosPorDocumentoRequest</con3:xqueryText></con2:expr><con2:message>identificarContratosPorDocumentoRequest</con2:message></con2:log></con1:requestTransform><con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ffb</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$identificarContratosPorDocumentoResponse</con3:xqueryText></con2:expr><con2:message>identificarContratosPorDocumentoResponse</con2:message></con2:log></con1:responseTransform></con1:wsCallout></con:actions></con:stage></con:pipeline><con:pipeline type="response" name="Listar Contratos por Documento_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Trata Retorno"><con:comment>Apos a pesquisa de identificação de contratos por documento no DSP, o estagio trata o saida de dados do proxy</con:comment><con:context><con1:userNsDecl namespace="http://www.netservicos.com.br/ContratoAssinante" prefix="ns5" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/ListarContratos/" prefix="lis" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context><con:actions><con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ffa</con2:id><con1:logLevel>debug</con1:logLevel><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText></con1:expr><con1:message>Response do proxy ListarContratosPS - operação consultar contratos por documento</con1:message></con1:log><con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">verificar se a consulta no DSP retornou dados</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ff8</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">not(empty($identificarContratosPorDocumentoResponse/ns5:contratoAssinante))</con2:xqueryText></con1:condition><con1:actions><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5659666900923734131-77355d14.14546f95acd.-7ffe</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr><con2:message>adsadasdasdasdasdasdasdasdasdsadddddddddddddddddd</con2:message></con2:log><con1:assign varName="contratoAssinante"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1645961414163318189-6dc9a5ad.14547ba8eab.-8000</con2:id><con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="Infraestrutura/transicao/relacionar/atendimento/transformation/RetornoDSLIdentificarContratosDocumentoXQuery"/><con2:param name="identificarContratosPorDocumentoResponse1"><con2:path>$identificarContratosPorDocumentoResponse</con2:path></con2:param></con2:xqueryTransform></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7227087142709378124-6d1f633.143f7932c1c.-7ffc</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante</con3:xqueryText></con2:expr><con2:message>### RETORNO</con2:message>
                </con2:log><con1:foreach><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5701477294958896631--acb7140.15f2b5872b1.-8000</con2:id><con1:variable>identificarContratosPorDocumentoResponse</con1:variable><con1:expression><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./ns5:contratoAssinante</con2:xpathText></con1:expression><con1:value-variable>contrato</con1:value-variable><con1:index-variable>idx</con1:index-variable><con1:total-variable>contador</con1:total-variable><con1:actions><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7227087142709378124-6d1f633.143f7932c1c.-7ffc</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contrato</con3:xqueryText></con2:expr><con2:message>### CONTRATO</con2:message>
                </con2:log><con1:ifThenElse><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-980524747130604282-29d537af.15f25f09859.-8000</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($contrato/ns5:MIGRACAO_NET_UNO) = '1'</con2:xqueryText></con1:condition><con1:actions><con1:replace varName="contratoAssinante" contents-only="false"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7594215933677335466--558a46c5.15fb5aa3496.-8000</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./ns5:contratoAssinante</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">''</con2:xqueryText></con1:expr></con1:replace></con1:actions></con1:case><con1:default/></con1:ifThenElse></con1:actions></con1:foreach><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7227087142709378124-6d1f633.143f7932c1c.-7ffc</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante</con3:xqueryText></con2:expr><con2:message>### RETORNO COM CONTRATO DELETADO</con2:message>
                </con2:log><con1:ifThenElse><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5701477294958896631--acb7140.15f2b5872b1.-7ffe</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">empty($contratoAssinante/ns5:contratoAssinante)</con2:xqueryText></con1:condition><con1:actions><con1:replace varName="body" contents-only="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ff1</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;lis:listarContratosPorDocumentoResponse>
	&lt;ns5:contratoAssinante>ATR-0086&lt;/ns5:contratoAssinante>
&lt;/lis:listarContratosPorDocumentoResponse>
</con2:xqueryText></con1:expr></con1:replace></con1:actions></con1:case><con1:default><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3859382819149292005-6b5b93d.14702aff50c.-8000</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante</con3:xqueryText></con2:expr><con2:message>contratoAssinante===========================================</con2:message></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1645961414163318189-6dc9a5ad.14547ba8eab.-7fff</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante/ns5:contratoAssinante</con3:xqueryText></con2:expr><con2:message>contratoAssinante%%%%%%%</con2:message></con2:log><con1:replace varName="body" contents-only="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ff1</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;lis:listarContratosPorDocumentoResponse>
		{$contratoAssinante/ns5:contratoAssinante}
&lt;/lis:listarContratosPorDocumentoResponse>
</con2:xqueryText></con1:expr></con1:replace><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ff0</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr><con2:message>Saida do proxy Listar Contratos - consultar por documento</con2:message></con2:log></con1:default></con1:ifThenElse></con1:actions></con1:case><con1:default><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ff5</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr><con2:message>sem retorno ¨&amp;¨&amp;¨&amp;¨&amp;¨&amp;¨&amp;¨&amp;¨&amp;¨&amp;</con2:message></con2:log><con1:replace varName="body" contents-only="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ff2</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;lis:listarContratosPorDocumentoResponse/>
</con2:xqueryText></con1:expr></con1:replace><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fef</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr><con2:message>Saida do proxy Listar Contratos - consultar por documento</con2:message></con2:log></con1:default></con1:ifThenElse></con:actions></con:stage></con:pipeline><con:pipeline type="request" name="Listar Contratos por Telefone_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Consultar Contratos por Documento"><con:comment>Consultar Contratos por Documento</con:comment><con:context><con1:varNsDecl namespace="http://www.netservicos.com.br/ListarContratos/" prefix="lis" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context><con:actions><con2:log xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5659666900923734131-77355d14.14546f95acd.-8000</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr><con2:message>body de entrada consulta por telefone</con2:message></con2:log><con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7feb</con2:id><con1:service xsi:type="ref:BusinessServiceRef" ref="Infraestrutura/transicao/relacionar/atendimento/businessservice/ConsultarContratoAssinanteBS" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/><con1:operation>identificarContratosPorTelefone</con1:operation><con1:request><con1:body>$identificarContratosPorTelefoneRequest</con1:body></con1:request><con1:response><con1:body>identificarContratosPorTelefoneResponse</con1:body></con1:response><con1:requestTransform><con1:assign varName="identificarContratosPorTelefoneRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fea</con2:id><con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="Infraestrutura/transicao/relacionar/atendimento/transformation/IdentificarContratoPorTelefoneRequestXQuery"/><con2:param name="listarContratosPorTelefoneRequest1"><con2:path>$body/lis:listarContratosPorTelefoneRequest</con2:path></con2:param></con2:xqueryTransform></con1:expr></con1:assign><con1:transport-headers copy-all="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2306531023829884598--2905fcc2.14639734c81.-7fff</con2:id><con1:header-set>outbound-request</con1:header-set><con1:header value="expression" name="j_identity_base"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/lis:listarContratosPorTelefoneRequest/base)</con2:xqueryText></con1:header></con1:transport-headers><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2306531023829884598--2905fcc2.14639734c81.-7ffe</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">data($body/lis:listarContratosPorTelefoneRequest/base)</con3:xqueryText></con2:expr><con2:message>j_identy_base</con2:message></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fe9</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$identificarContratosPorTelefoneRequest</con3:xqueryText></con2:expr><con2:message>identificarContratosPorTelefoneRequest</con2:message></con2:log></con1:requestTransform><con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fe8</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$identificarContratosPorTelefoneResponse</con3:xqueryText></con2:expr><con2:message>identificarContratosPorTelefoneResponse</con2:message></con2:log></con1:responseTransform></con1:wsCallout></con:actions></con:stage></con:pipeline><con:pipeline type="response" name="Listar Contratos por Telefone_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Trata Retorno"><con:comment>Apos a pesquisa de identificação de contratos por telefone no DSP, o estagio trata o saida de dados do proxy</con:comment><con:context><con1:userNsDecl namespace="http://www.netservicos.com.br/ContratoAssinante" prefix="ns5" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/ListarContratos/" prefix="lis" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context><con:actions><con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fe7</con2:id><con1:logLevel>debug</con1:logLevel><con1:message>Response do proxy ListarContratosPS - operação consultar contratos por telefone</con1:message></con1:log><con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">verificar se a consulta no DSP retornou dados</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fe6</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">not(empty($identificarContratosPorTelefoneResponse/ns5:contratoAssinante))</con2:xqueryText></con1:condition><con1:actions><con1:assign varName="contratoAssinante"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1645961414163318189-6dc9a5ad.14547ba8eab.-7ffe</con2:id><con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="Infraestrutura/transicao/relacionar/atendimento/transformation/RetornoDSLIdentificarContratosTelefoneXQuery"/><con2:param name="identificarContratosPorTelefoneResponse1"><con2:path>$identificarContratosPorTelefoneResponse</con2:path></con2:param></con2:xqueryTransform></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7227087142709378124-6d1f633.143f7932c1c.-7ffc</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante</con3:xqueryText></con2:expr><con2:message>### RETORNO</con2:message>
                </con2:log><con1:foreach><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5701477294958896631--acb7140.15f2b5872b1.-8000</con2:id><con1:variable>identificarContratosPorTelefoneResponse</con1:variable><con1:expression><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./ns5:contratoAssinante</con2:xpathText></con1:expression><con1:value-variable>contrato</con1:value-variable><con1:index-variable>idx</con1:index-variable><con1:total-variable>contador</con1:total-variable><con1:actions><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7227087142709378124-6d1f633.143f7932c1c.-7ffc</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contrato</con3:xqueryText></con2:expr><con2:message>### CONTRATO</con2:message>
                </con2:log><con1:ifThenElse><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-980524747130604282-29d537af.15f25f09859.-8000</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($contrato/ns5:MIGRACAO_NET_UNO) = '1'</con2:xqueryText></con1:condition><con1:actions><con1:replace varName="contratoAssinante" contents-only="false"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7594215933677335466--558a46c5.15fb5aa3496.-8000</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./ns5:contratoAssinante</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">''</con2:xqueryText></con1:expr></con1:replace></con1:actions></con1:case><con1:default/></con1:ifThenElse></con1:actions></con1:foreach><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7227087142709378124-6d1f633.143f7932c1c.-7ffc</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante</con3:xqueryText></con2:expr><con2:message>### RETORNO COM CONTRATO DELETADO</con2:message>
                </con2:log><con1:ifThenElse><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5701477294958896631--acb7140.15f2b5872b1.-7ffe</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">empty($contratoAssinante/ns5:contratoAssinante)</con2:xqueryText></con1:condition><con1:actions><con1:replace varName="body" contents-only="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7ff1</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;lis:listarContratosPorTelefoneResponse>
		&lt;ns5:contratoAssinante>ATR-0086&lt;/ns5:contratoAssinante>
&lt;/lis:listarContratosPorTelefoneResponse>
</con2:xqueryText></con1:expr></con1:replace></con1:actions></con1:case><con1:default><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3859382819149292005-6b5b93d.14702aff50c.-8000</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante</con3:xqueryText></con2:expr><con2:message>contratoAssinante===========================================</con2:message></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1645961414163318189-6dc9a5ad.14547ba8eab.-7fff</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoAssinante/ns5:contratoAssinante</con3:xqueryText></con2:expr><con2:message>contratoAssinante%%%%%%%</con2:message></con2:log><con1:replace varName="body" contents-only="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fe5</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;lis:listarContratosPorTelefoneResponse>
		{$contratoAssinante/ns5:contratoAssinante}
&lt;/lis:listarContratosPorTelefoneResponse></con2:xqueryText></con1:expr></con1:replace><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fe4</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr><con2:message>Saida do proxy Listar Contratos - consultar por telefone</con2:message></con2:log></con1:default></con1:ifThenElse></con1:actions></con1:case><con1:default><con1:replace varName="body" contents-only="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7337108382117023303--54af9c70.14514a00340.-7fe3</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;lis:listarContratosPorTelefoneResponse/>

</con2:xqueryText></con1:expr></con1:replace></con1:default></con1:ifThenElse></con:actions></con:stage></con:pipeline><con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      
    <con:branch-node type="operation" name="BranchNode1"><con:context/><con:branch-table><con:branch name="listarContratosPorDocumento"><con:operator>equals</con:operator><con:value/><con:flow><con:pipeline-node name="Listar Contratos por Documento"><con:comment>Listar Contratos por Documento - CPF ou CNPJ</con:comment><con:request>Listar Contratos por Documento_request</con:request><con:response>Listar Contratos por Documento_response</con:response></con:pipeline-node></con:flow></con:branch><con:branch name="listarContratosPorTelefone"><con:operator>equals</con:operator><con:value/><con:flow><con:pipeline-node name="Listar Contratos por Telefone"><con:comment>Listar Contratos por Telefone</con:comment><con:request>Listar Contratos por Telefone_request</con:request><con:response>Listar Contratos por Telefone_response</con:response></con:pipeline-node></con:flow></con:branch><con:default-branch><con:flow/></con:default-branch></con:branch-table></con:branch-node></con:flow>
  </ser:router>
</xml-fragment>