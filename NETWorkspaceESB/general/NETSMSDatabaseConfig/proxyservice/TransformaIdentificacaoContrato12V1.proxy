<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ser:coreEntry isProxy="true" isEnabled="true" isTracingEnabled="false" isAutoPublish="false" xmlns:ser="http://www.bea.com/wli/sb/services">
    <ser:description>Proxy Service responsável por transformar a entidade canônica IdentificacaoContrato para uma semântica que o legado entende.</ser:description>
    <ser:binding type="SOAP" isSoap12="true" xsi:type="con:SoapBindingType" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config">
      <con:wsdl ref="general/NETSMSDatabaseConfig/wsdl/proxy/TransformaIdentificacaoContratoWSDL12V1"/>
      <con:port>
        <con:name>TransformaIdentificacaoContratoWSDL12V1SOAP</con:name>
        <con:namespace>http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1</con:namespace>
      </con:port>
      <con:selector type="SOAP body">
        <con:mapping operation="transformaIdentificacaoContrato" value=""/>
      </con:selector>
    </ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
  </ser:coreEntry>
  <ser:endpointConfig xmlns:ser="http://www.bea.com/wli/sb/services">
    <tran:provider-id xmlns:tran="http://www.bea.com/wli/sb/transports">http</tran:provider-id>
    <tran:inbound xmlns:tran="http://www.bea.com/wli/sb/transports">true</tran:inbound>
    <tran:URI xmlns:tran="http://www.bea.com/wli/sb/transports">
      <env:value xmlns:env="http://www.bea.com/wli/config/env">/general/TransformaIdentificacaoContrato12V1</env:value>
    </tran:URI>
    <tran:inbound-properties xmlns:tran="http://www.bea.com/wli/sb/transports"/>
    <tran:all-headers xmlns:tran="http://www.bea.com/wli/sb/transports">true</tran:all-headers>
    <tran:provider-specific xmlns:tran="http://www.bea.com/wli/sb/transports"><http:inbound-properties xmlns:http="http://www.bea.com/wli/sb/transports/http"><http:client-authentication xsi:type="http:HttpBasicAuthenticationType"/></http:inbound-properties></tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-6831140187983217245-2d463b30.16ae5b9f451.-7ffc" xmlns:ser="http://www.bea.com/wli/sb/services">
    <con:pipeline type="request" name="Transforma Identificacao Contrato_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Estágio Validacao dados informados">
        <con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5082653279621615783-6e04cf13.1201626e533.-8000</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(not($body/iden:IdentificacaoContrato/iden:SmartCard/node())
     or $body/iden:IdentificacaoContrato/iden:SmartCard eq "") 
and
   (not($body/iden:IdentificacaoContrato/iden:Contrato/iden:NumeroContrato/node())
    or $body/iden:IdentificacaoContrato/iden:Contrato/iden:NumeroContrato eq "")
and
   (not($body/iden:IdentificacaoContrato/iden:Protocolo/node())
    or $body/iden:IdentificacaoContrato/iden:Protocolo eq "")
and
   (not($body/iden:IdentificacaoContrato/iden:EnderecoMAC/node())
    or $body/iden:IdentificacaoContrato/iden:EnderecoMAC eq "")</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5082653279621615783-6e04cf13.1201626e533.-7fff</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:expr>
                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText>
                  </con2:expr>
                  <con2:message>Ou Contrato ou Smart Card ou Protocolo ou Endereco MAC devem ser informados.</con2:message>
                </con2:log>
                <con1:Error>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f26</con2:id>
                  <con1:errCode>ESB-GERAL-0001</con1:errCode>
                  <con1:message>Ou Contrato ou Smart Card ou Protocolo ou Endereco MAC devem ser informados.</con1:message>
                </con1:Error>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:replace varName="body" contents-only="true">
                <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Replace no conteúdo do body, para normalizar o retorno. 
Evita o caso de algum consumidor não enviar um elemento 
ou enviar fora do padrão do esquema de retorno. 
Quando um elemento não é enviado, as operações de replace
não funcionam, seria necessário testar todos os replaces e 
colocar inserts antes.</con2:comment>
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3783249325508075015-648c46d8.1218814732f.-7ffb</con2:id>
                <con1:location>
                  <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
                </con1:location>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<tran:IdentificacaoContratoResponse xmlns:iden="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato">
    <tran:SmartCard>{fn:data($body/iden:IdentificacaoContrato/iden:SmartCard)}</tran:SmartCard>
    <tran:Contrato>
        <tran:NumeroContrato>{fn:data($body/iden:IdentificacaoContrato/iden:Contrato/iden:NumeroContrato)}</tran:NumeroContrato>
        <tran:CodigoOperadora>{fn:data($body/iden:IdentificacaoContrato/iden:Contrato/iden:CodigoOperadora)}</tran:CodigoOperadora>
        <tran:IdentificacaoCidade>{fn:data($body/iden:IdentificacaoContrato/iden:Contrato/iden:IdentificacaoCidade)}</tran:IdentificacaoCidade>
    </tran:Contrato>
    <tran:Protocolo>{fn:data($body/iden:IdentificacaoContrato/iden:Protocolo)}</tran:Protocolo>
    <tran:EnderecoMAC>{fn:data($body/iden:IdentificacaoContrato/iden:EnderecoMAC)}</tran:EnderecoMAC>
    <tran:AliasDatabase>{fn:data($body/iden:IdentificacaoContrato/iden:AliasDatabase)}</tran:AliasDatabase>
</tran:IdentificacaoContratoResponse>]]></con2:xqueryText>
                </con1:expr>
              </con1:replace>
            </con1:default>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Estágio Contrato Informado">
        <con:context>
          <con1:userNsDecl namespace="java:br.com.netservicos.sb.config.netsms.operadora" prefix="java" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.openuri.org/" prefix="m" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/Manifestacaoombudsman/schemas" prefix="ns0" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-780946256234128968-4d64951e.12183837a0f.-7fda</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato/node()
and $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato ne ""
)
and 
(not($body/tran:IdentificacaoContratoResponse/tran:SmartCard/node())
or $body/tran:IdentificacaoContratoResponse/tran:SmartCard eq ""
)
and 
(not($body/tran:IdentificacaoContratoResponse/tran:Protocolo/node())
or $body/tran:IdentificacaoContratoResponse/tran:Protocolo eq ""
)
and 
(not($body/tran:IdentificacaoContratoResponse/tran:EnderecoMAC/node())
or $body/tran:IdentificacaoContratoResponse/tran:EnderecoMAC eq ""
)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:ifThenElse>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-780946256234128968-4d64951e.12183837a0f.-7fe9</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora/node()
   and 
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora ne "")</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:wsCallout>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff4</con2:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="general/NETSMSDatabaseConfig/BusinessService/NETSMSOperadoraConfigBusinessService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>getNETSMSOperadoraByCodigoOperadora</con1:operation>
                        <con1:request>
                          <con1:body>$getNETSMSOperadoraRequest</con1:body>
                        </con1:request>
                        <con1:response>
                          <con1:body>getNETSMSOperadoraResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:assign varName="getNETSMSOperadoraRequest">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff3</con2:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;open:getNETSMSOperadoraByCodigoOperadora xmlns:open="http://www.openuri.org/">
    &lt;open:arg0>{data($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora)}&lt;/open:arg0>
&lt;/open:getNETSMSOperadoraByCodigoOperadora></con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                          <con1:replace varName="body" contents-only="true">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fed</con2:id>
                            <con1:location>
                              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:AliasDatabase</con2:xpathText>
                            </con1:location>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:AliasDatabase)</con2:xqueryText>
                            </con1:expr>
                          </con1:replace>
                          <con1:replace varName="body" contents-only="true">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fef</con2:id>
                            <con1:location>
                              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade</con2:xpathText>
                            </con1:location>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:CidadeContrato)</con2:xqueryText>
                            </con1:expr>
                          </con1:replace>
                        <con1:transport-headers><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5968204675237802189-499c6ff6.17c95929a70.-7ffe</con2:id><con1:header-set>inbound-response</con1:header-set><con1:header name="SOA-Base" value="expression"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($body/tran:IdentificacaoContratoResponse/tran:AliasDatabase)</con2:xqueryText></con1:header></con1:transport-headers></con1:responseTransform>
                      </con1:wsCallout>
                      <con1:ifThenElse>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4346454719138127387-3dec94d0.120251b92f8.-8000</con2:id>
                        <con1:case>
                          <con1:condition>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade/node())
   or
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade eq "")</con2:xqueryText>
                          </con1:condition>
                          <con1:actions>
                            <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ffa</con3:id>
                              <con2:logLevel>debug</con2:logLevel>
                              <con2:message>Cidade não encontrada para a operadora informada.</con2:message>
                            </con2:log>
                            <con1:Error>
                              <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f24</con2:id>
                              <con1:errCode>ESB-GERAL-0002</con1:errCode>
                              <con1:message>Cidade não encontrada para a operadora informada.</con1:message>
                            </con1:Error>
                          </con1:actions>
                        </con1:case>
                        <con1:default/>
                      </con1:ifThenElse>
                    </con1:actions>
                  </con1:case>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade/node()
   and 
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade ne "")</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:wsCallout>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff1</con2:id>
                        <con1:service xsi:type="ref:BusinessServiceRef" ref="general/NETSMSDatabaseConfig/BusinessService/NETSMSOperadoraConfigBusinessService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>getNETSMSOperadoraByCidadeContrato</con1:operation>
                        <con1:request>
                          <con1:body>$getNETSMSOperadoraRequest</con1:body>
                        </con1:request>
                        <con1:response>
                          <con1:body>getNETSMSOperadoraResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                          <con1:assign varName="getNETSMSOperadoraRequest">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff0</con2:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;open:getNETSMSOperadoraByCidadeContrato xmlns:open="http://www.openuri.org/">
    &lt;open:arg0>{data($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade)}&lt;/open:arg0>
&lt;/open:getNETSMSOperadoraByCidadeContrato></con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                          <con1:replace varName="body" contents-only="true">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fed</con2:id>
                            <con1:location>
                              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:AliasDatabase</con2:xpathText>
                            </con1:location>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:AliasDatabase)</con2:xqueryText>
                            </con1:expr>
                          </con1:replace>
                          <con1:replace varName="body" contents-only="true">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fed</con2:id>
                            <con1:location>
                              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora</con2:xpathText>
                            </con1:location>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:CodigoOperadora)</con2:xqueryText>
                            </con1:expr>
                          </con1:replace>
                        <con1:transport-headers><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5968204675237802189-499c6ff6.17c95929a70.-7ffe</con2:id><con1:header-set>inbound-response</con1:header-set><con1:header name="SOA-Base" value="expression"><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($body/tran:IdentificacaoContratoResponse/tran:AliasDatabase)</con2:xqueryText></con1:header></con1:transport-headers></con1:responseTransform>
                      </con1:wsCallout>
                      <con1:ifThenElse>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4346454719138127387-3dec94d0.120251b92f8.-7ffe</con2:id>
                        <con1:case>
                          <con1:condition>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora/node())
   or
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora eq "")</con2:xqueryText>
                          </con1:condition>
                          <con1:actions>
                            <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                              <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ffb</con3:id>
                              <con2:logLevel>debug</con2:logLevel>
                              <con2:message>Operadora não encontrada para a ciadade informada.</con2:message>
                            </con2:log>
                            <con1:Error>
                              <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f1a</con2:id>
                              <con1:errCode>ESB-GERAL-0006</con1:errCode>
                              <con1:message>Operadora não encontrada para a ciadade informada.</con1:message>
                            </con1:Error>
                          </con1:actions>
                        </con1:case>
                        <con1:default/>
                      </con1:ifThenElse>
                    </con1:actions>
                  </con1:case>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora/node())
   or 
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora eq "")
and
  (not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade/node())
   or
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade eq "")</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con1:Error>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f25</con2:id>
                        <con1:errCode>ESB-GERAL-0007</con1:errCode>
                        <con1:message>Quando o contrato é informado é obrigatório informar a Operadora ou Código da Cidade onde o contrato está localizado.</con1:message>
                      </con1:Error>
                    </con1:actions>
                  </con1:case>
                  <con1:default/>
                </con1:ifThenElse>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff4</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="relacionar/atendimento/contratovenda/businessservice/ContratoVendaBusinessService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>isContratoVendaExistente</con1:operation>
                  <con1:request>
                    <con1:body>$isContratoVendaExistente</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>isContratoVendaExistenteResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:transport-headers>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5343620521509794156--7e09ae7e.1271f005292.-7fec</con2:id>
                      <con1:header-set>outbound-request</con1:header-set>
                      <con1:header name="j_identity_base" value="expression">
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/tran:IdentificacaoContratoResponse/tran:AliasDatabase)</con2:xqueryText>
                      </con1:header>
                    </con1:transport-headers>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6181762466736553342--3f0c2909.1282b9ca6d7.-8000</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body/tran:IdentificacaoContratoResponse</con3:xqueryText>
                      </con2:expr>
                      <con2:message>LOG***BASE**</con2:message>
                    </con2:log>
                    <con1:assign varName="isContratoVendaExistente">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff3</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<con:isContratoVendaExistente xmlns:con="ld:br/com/netservicos/atendimento/contratovenda/webservice/ContratoVendaJWS.ws">
    <con:identificadorCidade>{fn:data($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade)}</con:identificadorCidade>
    <con:numeroContrato>{fn:data($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato)}</con:numeroContrato>
</con:isContratoVendaExistente>]]></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform/>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-261802510793530758-30734140.128040be15b.-7ffb</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">not($isContratoVendaExistenteResponse/ns0:ContratoVendaDSP/ns0:QUANTIDADE_CONTRATO/node())</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ffa</con3:id>
                        <con2:logLevel>debug</con2:logLevel>
                        <con2:expr>
                          <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$isContratoVendaExistenteResponse/ns0:isContratoVendaExistenteResponse/ns0:ContratoVendaDSP</con3:xqueryText>
                        </con2:expr>
                        <con2:message>Contrato Não Encontrado !</con2:message>
                      </con2:log>
                      <con1:Error>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f24</con2:id>
                        <con1:errCode>ESB-GERAL-0005</con1:errCode>
                        <con1:message>Contrato não encontrado para os parâmetros informados.</con1:message>
                      </con1:Error>
                    </con1:actions>
                  </con1:case>
                  <con1:default/>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Estágio SmartCard ou EnderecoMAC Informado" errorHandler="_onErrorHandler-4346454719138127387-3dec94d0.120251b92f8.-7ff8">
        <con:context>
          <con1:userNsDecl namespace="ld:br/com/netservicos/equipamento/ds/logical/EQUIPAMENTO_ws" prefix="equipamento" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="Equipamento_Logico" prefix="equipamentoLogico" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5082653279621615783-6e04cf13.1201626e533.-7ffc</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(($body/tran:IdentificacaoContratoResponse/tran:SmartCard/node())
    and ($body/tran:IdentificacaoContratoResponse/tran:SmartCard ne ""))
or
(($body/tran:IdentificacaoContratoResponse/tran:EnderecoMAC/node())
    and ($body/tran:IdentificacaoContratoResponse/tran:EnderecoMAC ne ""))    
and 
(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato/node())
or $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato eq ""
)
and 
(not($body/tran:IdentificacaoContratoResponse/tran:Protocolo/node())
or $body/tran:IdentificacaoContratoResponse/tran:Protocolo eq ""
)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-124359887286415212--17c4b8c2.1201f090284.-8000</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="Infraestrutura/Equipamento/Equipamentos/BusinessService/EquipamentoBusinessV1_1" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>consultarEquipamentoPorEnderecavel</con1:operation>
                  <con1:request>
                    <con1:body>$consultarEquipamentoPorEnderecavelRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>consultarEquipamentoPorEnderecavelResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:ifThenElse>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-780946256234128968-4d64951e.12183837a0f.-8000</con2:id>
                      <con1:case>
                        <con1:condition>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(($body/tran:IdentificacaoContratoResponse/tran:SmartCard/node())
    and ($body/tran:IdentificacaoContratoResponse/tran:SmartCard ne ""))</con2:xqueryText>
                        </con1:condition>
                        <con1:actions>
                          <con1:assign varName="consultarEquipamentoPorEnderecavelRequest">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-124359887286415212--17c4b8c2.1201f090284.-7fff</con2:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;equ:consultarEquipamentoPorEnderecavel xmlns:equ="ld:br/com/netservicos/equipamento/ds/logical/EQUIPAMENTO_ws">
   &lt;equ:cdEnderecavel>{data($body/tran:IdentificacaoContratoResponse/tran:SmartCard)}&lt;/equ:cdEnderecavel>
&lt;/equ:consultarEquipamentoPorEnderecavel></con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:actions>
                      </con1:case>
                      <con1:default>
                        <con1:assign varName="consultarEquipamentoPorEnderecavelRequest">
                          <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-124359887286415212--17c4b8c2.1201f090284.-7fff</con2:id>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;equ:consultarEquipamentoPorEnderecavel xmlns:equ="ld:br/com/netservicos/equipamento/ds/logical/EQUIPAMENTO_ws">
   &lt;equ:cdEnderecavel>{data($body/tran:IdentificacaoContratoResponse/tran:EnderecoMAC)}&lt;/equ:cdEnderecavel>
&lt;/equ:consultarEquipamentoPorEnderecavel></con2:xqueryText>
                          </con1:expr>
                        </con1:assign>
                      </con1:default>
                    </con1:ifThenElse>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-124359887286415212--17c4b8c2.1201f090284.-7ffd</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($consultarEquipamentoPorEnderecavelResponse/equipamentoLogico:EQUIPAMENTOS/EQUIPAMENTO/CD_CIDADE_NETSMS)</con2:xqueryText>
                      </con1:expr>
                    </con1:replace>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-124359887286415212--17c4b8c2.1201f090284.-7ffd</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($consultarEquipamentoPorEnderecavelResponse/equipamentoLogico:EQUIPAMENTOS/EQUIPAMENTO/CD_CONTRATO_NETSMS)</con2:xqueryText>
                      </con1:expr>
                    </con1:replace>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Estágio Validação SmartCard ou EnderecoMAC Informado">
        <con:context>
          <con1:userNsDecl namespace="Equipamento_Logico" prefix="equipamentoLogico" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="ld:br/com/netservicos/equipamento/ds/logical/EQUIPAMENTO_ws" prefix="equipamento" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3783249325508075015-648c46d8.1218814732f.-7ff8</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">($consultarEquipamentoPorEnderecavelResponse//equipamentoLogico:EQUIPAMENTOS/EQUIPAMENTO/ID_EQUIPAMENTO/node()
and
$consultarEquipamentoPorEnderecavelResponse//equipamentoLogico:EQUIPAMENTOS/EQUIPAMENTO/ID_EQUIPAMENTO ne "")
and 
(
not($consultarEquipamentoPorEnderecavelResponse//equipamentoLogico:EQUIPAMENTOS/EQUIPAMENTO/NM_LOCAL/node())
or
($consultarEquipamentoPorEnderecavelResponse//equipamentoLogico:EQUIPAMENTOS/EQUIPAMENTO/NM_LOCAL ne "ASSINANTE")
)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:Error>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f1d</con2:id>
                  <con1:errCode>ESB-GERAL-0003</con1:errCode>
                  <con1:message>Equipamento vinculado ao Smartcard ou Endereço Mac informado, não está vinculado a um assinante.</con1:message>
                </con1:Error>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Estágio Protocolo Informado">
        <con:context>
          <con1:userNsDecl namespace="http://www.openuri.org/" prefix="m" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="java:br.com.netservicos.sb.config.netsms.operadora" prefix="java" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="ld:br/com/netservicos/atendimento/webservice/ConsultarContratoContatoJWS.ws" prefix="con" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:userNsDecl namespace="http://www.netservicos.com.br/atendimento/identificacaocontrato" prefix="ns0" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-780946256234128968-4d64951e.12183837a0f.-7fd1</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">($body/tran:IdentificacaoContratoResponse/tran:Protocolo/node()
and $body/tran:IdentificacaoContratoResponse/tran:Protocolo ne ""
)   
and 
(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato/node())
or $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato eq ""
)
and 
(not($body/tran:IdentificacaoContratoResponse/tran:SmartCard/node())
or $body/tran:IdentificacaoContratoResponse/tran:SmartCard eq ""
)
and 
(not($body/tran:IdentificacaoContratoResponse/tran:EnderecoMAC/node())
or $body/tran:IdentificacaoContratoResponse/tran:EnderecoMAC eq ""
)</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:replace varName="body" contents-only="true">
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fed</con2:id>
                  <con1:location>
                    <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora</con2:xpathText>
                  </con1:location>
                  <con1:expr>
                    <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:substring($body/tran:IdentificacaoContratoResponse/tran:Protocolo,1,3)</con2:xqueryText>
                  </con1:expr>
                </con1:replace>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff4</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="general/NETSMSDatabaseConfig/BusinessService/NETSMSOperadoraConfigBusinessService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getNETSMSOperadoraByCodigoOperadora</con1:operation>
                  <con1:request>
                    <con1:body>$getNETSMSOperadoraRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>getNETSMSOperadoraResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="getNETSMSOperadoraRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff3</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;open:getNETSMSOperadoraByCodigoOperadora xmlns:open="http://www.openuri.org/">
    &lt;open:arg0>{data($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora)}&lt;/open:arg0>
&lt;/open:getNETSMSOperadoraByCodigoOperadora></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fed</con2:id>
                      <con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:AliasDatabase</con2:xpathText></con1:location>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:AliasDatabase)</con2:xqueryText>
                      </con1:expr>
                    </con1:replace>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fef</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:CidadeContrato)</con2:xqueryText>
                      </con1:expr>
                    </con1:replace>
                  <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7fd2</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config"><![CDATA[<objeto>
<retornoResponse></retornoResponse>
<body>{$body}</body>
<identificacaoResponse>{$body/tran:IdentificacaoContratoResponse }</identificacaoResponse>
<identificacao>{$body/tran:IdentificacaoContrato }</identificacao>
<alias>{fn:data($getNETSMSOperadoraResponse/m:return/java:AliasDatabase)}</alias>
<retonroEjb>{$getNETSMSOperadoraResponse}</retonroEjb>
</objeto>]]></con3:xqueryText></con2:expr></con2:log></con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4346454719138127387-3dec94d0.120251b92f8.-8000</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade/node())
   or
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade eq "")</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ffa</con3:id>
                        <con2:logLevel>debug</con2:logLevel>
                        <con2:message>Cidade não encontrada para a operadora informada.</con2:message>
                      </con2:log>
                      <con1:Error><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f1c</con2:id><con1:errCode>ESB-GERAL-0004</con1:errCode><con1:message>Cidade / Operadora não encontrada para Protocolo Informado. Verifique o Protocolo.</con1:message></con1:Error>
                      
                      
                    </con1:actions>
                  </con1:case>
                  <con1:default/>
                </con1:ifThenElse>
                <con1:wsCallout><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7fff</con2:id><con1:service xsi:type="ref:BusinessServiceRef" ref="general/NETSMSDatabaseConfig/BusinessService/ConsultarContratoContatoBSV1" xmlns:ref="http://www.bea.com/wli/sb/reference"/><con1:operation>consultarContratoPorProtocolo</con1:operation><con1:request><con1:body>$contratoRequest</con1:body></con1:request><con1:response><con1:body>contratoResponse</con1:body></con1:response><con1:requestTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ffc</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">'contratoRequest::Inicio********'</con3:xqueryText></con2:expr></con2:log><con3:transport-headers copy-all="false" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config" xmlns:env="http://www.bea.com/wli/config/env" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                <con2:id>_ActionId-35892117379521315-53d7bce.1201f1cf21e.-7fe4</con2:id>
                <con3:header-set>outbound-request</con3:header-set>
                <con3:header name="j_identity_base" value="expression">
                  
                <con2:xqueryText>fn:data($body/tran:IdentificacaoContratoResponse/tran:AliasDatabase)</con2:xqueryText></con3:header>
              </con3:transport-headers><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ff1</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">fn:concat('Base****:',fn:data($body/tran:IdentificacaoContratoResponse/tran:AliasDatabase))</con3:xqueryText></con2:expr></con2:log><con1:assign varName="contratoRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ff4</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;con:consultarContratoPorProtocolo>
    &lt;con:numeroProtocolo>{fn:data($body/tran:IdentificacaoContratoResponse/tran:Protocolo)}&lt;/con:numeroProtocolo>
&lt;/con:consultarContratoPorProtocolo>
</con2:xqueryText></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ffb</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoRequest</con3:xqueryText></con2:expr></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ffa</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">'contratoRequest::Fim**********'</con3:xqueryText></con2:expr></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ff0</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr></con2:log></con1:requestTransform><con1:responseTransform><con1:replace varName="body" contents-only="true"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ffd</con2:id><con1:location><con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato</con2:xpathText></con1:location><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($contratoResponse/ns0:Contrato/NumeroContrato)</con2:xqueryText></con1:expr></con1:replace><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ff8</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">'contratoResponse::Inicio********'</con3:xqueryText></con2:expr></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ff9</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$contratoResponse</con3:xqueryText></con2:expr></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7142408646406179369--263638b5.12536cc7af4.-7ff7</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">'contratoResponse::Fim**********'</con3:xqueryText></con2:expr></con2:log></con1:responseTransform></con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Estágio Validação retorno buscar Contrato">
        <con:context>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Colocado fora do estágio do service callout para não afetar o tratamento do error handler.</con2:comment>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4346454719138127387-3dec94d0.120251b92f8.-7ffc</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato)
    or ($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato eq ""))</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ff8</con3:id>
                  <con2:logLevel>debug</con2:logLevel>
                  <con2:message>Contrato não encontrado para os parâmetros informados.</con2:message>
                </con2:log>
                <con1:Error>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f1b</con2:id>
                  <con1:errCode>ESB-GERAL-0005</con1:errCode>
                  <con1:message>Contrato não encontrado para os parâmetros informados.</con1:message>
                </con1:Error>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Estágio buscar operadora e alias da base por cidade">
        <con:context>
          <con1:userNsDecl namespace="http://www.openuri.org/" prefix="m" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="java:br.com.netservicos.sb.config.netsms.operadora" prefix="java" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-780946256234128968-4d64951e.12183837a0f.-7ffc</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade/node()
   and 
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade ne "")
and
  (not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora/node())
   or
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora eq ""))
or (not($body/tran:IdentificacaoContratoResponse/tran:AliasDatabase/node())
   or
   $body/tran:IdentificacaoContratoResponse/tran:AliasDatabase eq "")</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff1</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="general/NETSMSDatabaseConfig/BusinessService/NETSMSOperadoraConfigBusinessService" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con1:operation>getNETSMSOperadoraByCidadeContrato</con1:operation>
                  <con1:request>
                    <con1:body>$getNETSMSOperadoraRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>getNETSMSOperadoraResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="getNETSMSOperadoraRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7ff0</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;open:getNETSMSOperadoraByCidadeContrato xmlns:open="http://www.openuri.org/">
    &lt;open:arg0>{data($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:IdentificacaoCidade)}&lt;/open:arg0>
&lt;/open:getNETSMSOperadoraByCidadeContrato></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fed</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:AliasDatabase</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:AliasDatabase)</con2:xqueryText>
                      </con1:expr>
                    </con1:replace>
                    <con1:replace varName="body" contents-only="true">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2532517050863924303--7b7c12fb.1201b6e98e8.-7fed</con2:id>
                      <con1:location>
                        <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora</con2:xpathText>
                      </con1:location>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($getNETSMSOperadoraResponse/m:return/java:CodigoOperadora)</con2:xqueryText>
                      </con1:expr>
                    </con1:replace>
                  </con1:responseTransform>
                </con1:wsCallout>
                <con1:ifThenElse>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4346454719138127387-3dec94d0.120251b92f8.-7ffe</con2:id>
                  <con1:case>
                    <con1:condition>
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">(not($body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora/node())
   or
   $body/tran:IdentificacaoContratoResponse/tran:Contrato/tran:CodigoOperadora eq "")</con2:xqueryText>
                    </con1:condition>
                    <con1:actions>
                      <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ffb</con3:id>
                        <con2:logLevel>debug</con2:logLevel>
                        <con2:message>Operadora não encontrada para a ciadade informada.</con2:message>
                      </con2:log>
                      <con1:Error>
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7507466032380167795--4d436345.1225bef58d7.-7f1a</con2:id>
                        <con1:errCode>ESB-GERAL-0006</con1:errCode>
                        <con1:message>Operadora não encontrada para a ciadade informada.</con1:message>
                      </con1:Error>
                    </con1:actions>
                  </con1:case>
                  <con1:default/>
                </con1:ifThenElse>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="response" name="Transforma Identificacao Contrato_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"/>
    <con:pipeline type="error" name="_onErrorHandler-4346454719138127387-3dec94d0.120251b92f8.-7ff8" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Error Handler Estágio SmartCard ou EnderecoMAC Informado">
        <con:context>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/v2/NetHeader" prefix="net" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ff7</con2:id>
            <con1:location>
              <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">.</con2:xpathText>
            </con1:location>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<soap-env:Fault>
  <faultcode>{data($fault/ctx:errorCode)}</faultcode>
  <faultstring>{data($fault/ctx:reason)}</faultstring>
  <detail>{$fault}
  </detail>
</soap-env:Fault>]]></con2:xqueryText>
            </con1:expr>
          </con1:replace>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6982888663598986474-1e25a999.12025b7f60e.-7ffc</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro no Data Service: br/com/netservicos/equipamento/servico/EQUIPAMENTO.ws EQUIPAMENTO método consultarEquipamentoPorEnderecavel</con1:message>
          </con1:log>
          <con1:report xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4346454719138127387-3dec94d0.120251b92f8.-7ff6</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$body</con2:xqueryText>
            </con1:expr>
            <con1:labels>
              <con1:key>Consumidor</con1:key>
              <con1:varName>header</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./net:NetHeader/aplicacao</con2:xpathText>
              </con1:value>
            </con1:labels>
            <con1:labels>
              <con1:key>Funcionalidade</con1:key>
              <con1:varName>header</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./net:NetHeader/funcionalidade</con2:xpathText>
              </con1:value>
            </con1:labels>
            <con1:labels>
              <con1:key>Usuário</con1:key>
              <con1:varName>header</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./net:NetHeader/username</con2:xpathText>
              </con1:value>
            </con1:labels>
            <con1:labels>
              <con1:key>Contrato</con1:key>
              <con1:varName>body</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Contrato/tran:NumeroContrato</con2:xpathText>
              </con1:value>
            </con1:labels>
            <con1:labels>
              <con1:key>SmartCard</con1:key>
              <con1:varName>body</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:SmartCard</con2:xpathText>
              </con1:value>
            </con1:labels>
            <con1:labels>
              <con1:key>Protocolo</con1:key>
              <con1:varName>body</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:Protocolo</con2:xpathText>
              </con1:value>
            </con1:labels>
            <con1:labels>
              <con1:key>EnderecoMAC</con1:key>
              <con1:varName>body</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:EnderecoMAC</con2:xpathText>
              </con1:value>
            </con1:labels>
            <con1:labels>
              <con1:key>AliasDataBase</con1:key>
              <con1:varName>body</con1:varName>
              <con1:value>
                <con2:xpathText xmlns:con2="http://www.bea.com/wli/sb/stages/config">./tran:IdentificacaoContratoResponse/tran:AliasDatabase</con2:xpathText>
              </con1:value>
            </con1:labels>
          </con1:report>
          <con1:alert xmlns:con1="http://www.bea.com/wli/sb/stages/alert/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4346454719138127387-3dec94d0.120251b92f8.-7ff5</con2:id>
            <con1:description>Erro no Data Service: br/com/netservicos/equipamento/servico/EQUIPAMENTO.ws EQUIPAMENTO método consultarEquipamentoPorEnderecavel</con1:description>
            <con1:severity>major</con1:severity>
            <con1:payload>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:payload>
          </con1:alert>
          <con1:transport-headers xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8860558302490276716--75ff3585.1699161cd2f.-8000</con2:id>
            <con1:header-set>inbound-response</con1:header-set>
            <con1:header name="SOA-Code" value="expression">
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/transformation/FormatTransportHeaderResponseCodeXQTv1"/>
                <con2:param name="body"><con2:path>$body</con2:path></con2:param>
                <con2:param name="fault"><con2:path>$fault</con2:path></con2:param>
              </con2:xqueryTransform>
	        </con1:header>
          </con1:transport-headers>

          <con1:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
            <con1:id>_ActionId-4346454719138127387-3dec94d0.120251b92f8.-7ff7</con1:id>
          </con1:reply>
        </con:actions>
      </con:stage>
    </con:pipeline>
    <con:pipeline type="error" name="_onErrorHandler-6831140187983217245-2d463b30.16ae5b9f451.-7ffc" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="stage1"><con:context/><con:actions><con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config"><con2:id>_ActionId-1509255832891877887-6052c751.128887c6c38.-8000</con2:id><con4:logLevel>error</con4:logLevel><con4:expr><con2:xqueryText>$fault</con2:xqueryText></con4:expr><con4:message>Erro ao Transformar Identificação Contrato</con4:message></con4:log><con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-2200672819673162128--307c079d.1756f86f1cc.-8000</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:contains($fault, "ORA-") or
fn:contains($body, "ORA-")</con2:xqueryText></con1:condition><con1:actions><con1:transport-headers>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8860558302490276716--75ff3585.1699161cd2f.-8000</con2:id>
            <con1:header-set>inbound-response</con1:header-set>
            <con1:header value="expression" name="SOA-Code">
              
	        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="general/transformation/FormatTransportHeaderResponseORAErrorXQTv1"/><con2:param name="fault"><con2:path>$fault</con2:path></con2:param><con2:param name="body"><con2:path>$body</con2:path></con2:param></con2:xqueryTransform></con1:header>
          </con1:transport-headers></con1:actions></con1:case><con1:default><con1:transport-headers>
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-8860558302490276716--75ff3585.1699161cd2f.-8000</con2:id>
            <con1:header-set>inbound-response</con1:header-set>
            <con1:header name="SOA-Code" value="expression">
              
	        <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="general/transformation/FormatTransportHeaderResponseCodeXQTv1"/><con2:param name="fault"><con2:path>$fault</con2:path></con2:param><con2:param name="body"><con2:path>$body</con2:path></con2:param></con2:xqueryTransform></con1:header>
          </con1:transport-headers></con1:default></con1:ifThenElse><con1:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
            <con1:id>_ActionId-7007574487356270431-6cdc776f.1205cc0ed95.-7ff5</con1:id>
          </con1:reply></con:actions></con:stage></con:pipeline><con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:pipeline-node name="Transforma Identificacao Contrato">
        <con:request>Transforma Identificacao Contrato_request</con:request>
        <con:response>Transforma Identificacao Contrato_response</con:response>
      </con:pipeline-node>
    </con:flow>
  </ser:router>
</xml-fragment>