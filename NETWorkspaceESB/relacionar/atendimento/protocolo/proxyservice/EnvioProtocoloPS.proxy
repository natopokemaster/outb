<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment>
  <ser:coreEntry isProxy="true" isEnabled="true" xmlns:ser="http://www.bea.com/wli/sb/services">
    <ser:description>Proxy local para envio de protocolo. executa a identificação de base, 
verificação se o protocolo já foi enviado e se necessario envia o protocolo</ser:description><ser:binding type="Mixed" xsi:type="con:MixedBindingType" xmlns:con="http://www.bea.com/wli/sb/services/bindings/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:request type="XML">
        <con1:schema ref="relacionar/atendimento/protocolo/schemas/MensagemEnvioProtocoloFila" element="mensagemEnvioProtocolo" xmlns:con1="http://www.bea.com/wli/sb/typesystem/config"/>
      </con:request>
    <con:response type="XML"><con1:schema ref="relacionar/atendimento/protocolo/schemas/MensagemEnvioProtocoloFila" element="retornoProtocolo" xmlns:con1="http://www.bea.com/wli/sb/typesystem/config"/></con:response></ser:binding>
    <ser:monitoring isEnabled="false">
      <ser:aggregationInterval>10</ser:aggregationInterval>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
  </ser:coreEntry>
  <ser:endpointConfig xmlns:ser="http://www.bea.com/wli/sb/services">
    <tran:provider-id xmlns:tran="http://www.bea.com/wli/sb/transports">local</tran:provider-id>
    <tran:inbound xmlns:tran="http://www.bea.com/wli/sb/transports">true</tran:inbound>
    <tran:inbound-properties xmlns:tran="http://www.bea.com/wli/sb/transports"/>
    <tran:all-headers xmlns:tran="http://www.bea.com/wli/sb/transports">true</tran:all-headers>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-7839667951829878866-3bc8b553.16413d61301.-8000" xmlns:ser="http://www.bea.com/wli/sb/services"><con:pipeline type="request" name="Envio Protocolo_request" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Serviço externo de Identificação da base" errorHandler="_onErrorHandler-550807396897535505-1fac6b1b.163ef1203e0.-7f3b"><con:comment>Estágio que realiza a chamada ao serviço externo de Identificação da base.</con:comment><con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoProposta12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prot" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        <con1:varNsDecl namespace="http://www.netservicos.com.br/EnvioProtocolo" prefix="env" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/MensagemEnvioProtocoloFila" prefix="men" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoProposta" prefix="iden1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context><con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Identifica base de dados com base no contrato OU na proposta</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f43</con2:id>
            <con1:case>
              <con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:Contrato/iden:NumeroContrato/node()) 
and 
data($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:Contrato/iden:NumeroContrato) != ''</con2:xqueryText></con1:condition>
              <con1:actions>
                <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f34</con3:id><con2:logLevel>debug</con2:logLevel><con2:message>Identificando base com base no contrato</con2:message></con2:log><con1:wsCallout>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">identifica base de dados atraves do contrato fornecido</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fc5</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="relacionar/atendimento/protocolo/businessservice/TransformaIdentificacaoContratoBS" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                  
                  <con1:operation>transformaIdentificacaoContrato</con1:operation><con1:request><con1:body>$transformaIdentificacaoContratoRequest</con1:body></con1:request>
                  <con1:response><con1:body>transformaIdentificacaoContratoResponse</con1:body></con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="transformaIdentificacaoContratoRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fc4</con2:id>
                      <con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<iden:IdentificacaoContrato xmlns:iden="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato">
    <iden:SmartCard>{data($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:SmartCard)}</iden:SmartCard>
    <iden:Contrato>
        <iden:NumeroContrato>{data($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:Contrato/iden:NumeroContrato)}</iden:NumeroContrato>
        <iden:CodigoOperadora>{data($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:Contrato/iden:CodigoOperadora)}</iden:CodigoOperadora>
        <iden:IdentificacaoCidade>{data($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:Contrato/iden:IdentificacaoCidade)}</iden:IdentificacaoCidade>
    </iden:Contrato>
    <iden:Protocolo>{data($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:Protocolo)}</iden:Protocolo>
    <iden:EnderecoMAC>{data($body/men:mensagemEnvioProtocolo/men:identificacaoContrato/iden:EnderecoMAC)}</iden:EnderecoMAC>
</iden:IdentificacaoContrato>
]]></con2:xqueryText></con1:expr>
                    </con1:assign>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f85</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoContratoRequest</con3:xqueryText>
                      </con2:expr>
                      <con2:message>transformaIdentificacaoContratoRequest</con2:message>
                    </con2:log>
                  </con1:requestTransform>
                  <con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f30</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoContratoResponse</con3:xqueryText></con2:expr><con2:message>transformaIdentificacaoContratoResponse</con2:message></con2:log><con1:assign varName="baseDados"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f2c</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoContratoResponse/tran1:AliasDatabase)</con2:xqueryText></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f2b</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$baseDados</con3:xqueryText></con2:expr><con2:message>base de dados</con2:message></con2:log></con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">exists($body/men:mensagemEnvioProtocolo/men:identificacaoProposta/iden1:Proposta/iden1:NumeroProposta/node())
and 
data($body/men:mensagemEnvioProtocolo/men:identificacaoProposta/iden1:Proposta/iden1:NumeroProposta) != ''

</con2:xqueryText></con1:condition><con1:actions><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f33</con3:id><con2:logLevel>debug</con2:logLevel><con2:message>Identicando base de dados com base na proposta</con2:message></con2:log><con1:wsCallout>
                  <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">identifica a base de dados atraves da proposta fornecida</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7ff9</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="relacionar/atendimento/protocolo/businessservice/TransformaIdentificacaoPropostaBS" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                  
                  <con1:operation>transformaIdentificacaoProposta</con1:operation><con1:request><con1:body>$transformaIdentificacaoPropostaRequest</con1:body></con1:request>
                  <con1:response><con1:body>transformaIdentificacaoPropostaResponse</con1:body></con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="transformaIdentificacaoPropostaRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7fc4</con2:id>
                      <con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<iden1:IdentificacaoProposta xmlns:iden1="http://www.netservicos.com.br/modelocanonico/v2/identificacaoProposta">
    <iden1:Proposta>
        <iden1:NumeroProposta>{data($body/men:mensagemEnvioProtocolo/men:identificacaoProposta/iden1:Proposta/iden1:NumeroProposta)}</iden1:NumeroProposta>
        <iden1:CodigoOperadora>{data($body/men:mensagemEnvioProtocolo/men:identificacaoProposta/iden1:Proposta/iden1:CodigoOperadora)}</iden1:CodigoOperadora>
        <iden1:IdentificacaoCidade>{data($body/men:mensagemEnvioProtocolo/men:identificacaoProposta/iden1:Proposta/iden1:IdentificacaoCidade)}</iden1:IdentificacaoCidade>
    </iden1:Proposta>
</iden1:IdentificacaoProposta>]]></con2:xqueryText></con1:expr>
                    </con1:assign>
                    <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config">
                      <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f85</con3:id>
                      <con2:logLevel>debug</con2:logLevel>
                      <con2:expr>
                        <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoContratoRequest</con3:xqueryText>
                      </con2:expr>
                      <con2:message>transformaIdentificacaoContratoRequest</con2:message>
                    </con2:log>
                  </con1:requestTransform>
                  <con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f2f</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$transformaIdentificacaoPropostaResponse</con3:xqueryText></con2:expr><con2:message>transformaIdentificacaoPropostaResponse</con2:message></con2:log><con1:assign varName="baseDados"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f2a</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">fn:data($transformaIdentificacaoPropostaResponse/tran:AliasDatabase)</con2:xqueryText></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f29</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$baseDados</con3:xqueryText></con2:expr><con2:message>base de dados</con2:message></con2:log></con1:responseTransform>
                </con1:wsCallout></con1:actions></con1:case><con1:default><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f32</con3:id><con2:logLevel>error</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$body</con3:xqueryText></con2:expr><con2:message>CONTRATO OU PROPOSTA DEVEM SER PREENCHIDOS</con2:message></con2:log><con1:assign varName="localMessageParameters"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f2e</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>
	&lt;logging:value>'Transforma Identificação Contrato ou Proposta'&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText></con1:expr></con1:assign><con1:assign varName="errorHandlerRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f2d</con2:id><con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/><con2:param name="additionalInformation"><con2:path>$body</con2:path></con2:param><con2:param name="currentFault"><con2:path>$null</con2:path></con2:param><con2:param name="exceptionStackTrace"><con2:path>$null</con2:path></con2:param><con2:param name="accessResourceName"><con2:path>'EnvioProtocoloPS'</con2:path></con2:param><con2:param name="responseSOAPVersion"><con2:path>'1.2'</con2:path></con2:param><con2:param name="currentBody"><con2:path>$body</con2:path></con2:param><con2:param name="exceptionClassification"><con2:path>'CLASSIFICATION_VALIDATION'</con2:path></con2:param><con2:param name="messageParameters"><con2:path>$localMessageParameters</con2:path></con2:param><con2:param name="processo"><con2:path>'atendimento'</con2:path></con2:param><con2:param name="macroProcesso"><con2:path>'Relacionar'</con2:path></con2:param><con2:param name="validationMessages"><con2:path>&lt;validationMessages/></con2:path></con2:param><con2:param name="callResponse"><con2:path>$null</con2:path></con2:param><con2:param name="messageCode"><con2:path>'ESB-ATEND-0012'</con2:path></con2:param><con2:param name="currentInbound"><con2:path>$inbound</con2:path></con2:param></con2:xqueryTransform></con1:expr></con1:assign><con1:Error><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f31</con2:id><con1:errCode>ESB-ATEND-0012</con1:errCode><con1:message>Campo {0} é Obrigatório.</con1:message></con1:Error></con1:default>
          </con1:ifThenElse>
        </con:actions></con:stage><con:stage name="Verifica Envio Protocolo " errorHandler="_onErrorHandler-550807396897535505-1fac6b1b.163ef1203e0.-7f03"><con:comment>Estagio responsavel por verificar se protocolo pode ser enviado</con:comment><con:context>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/EnvioProtocolo" prefix="env" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoProposta" prefix="iden" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/identificacaoContrato" prefix="iden1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context><con:actions>
          <con1:assign varName="protocolo" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f0f</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/env:enviarProtocoloRequest/env:protocolo)</con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">se reenvio igual a false então consultar se realmente protocolo ainda não foi enviado</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f0e</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">data($body/env:enviarProtocoloRequest/env:reenvio) = fn:false()</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3120794938986654994--787bb157.149eda2b794.-8000</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="relacionar/atendimento/envioprotocolo/businessservice/EnvioProtocoloServiceEJBBSV1_0" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                  <con1:operation>verificarProtocoloEnviado</con1:operation>
                  <con1:request>
                    <con1:body>$verificarProtocoloEnviadoRequest</con1:body>
                    <con1:header>$header</con1:header>
                  </con1:request>
                  <con1:response>
                    <con1:body>verificarProtocoloEnviadoResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:assign varName="verificarProtocoloEnviadoRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3120794938986654994--787bb157.149eda2b794.-7ffc</con2:id>
                      <con1:expr>
                        <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;ns2:verificarProtocoloEnviado xmlns:ns2="http://www.openuri.org/">
	&lt;ns2:arg0>{data($protocolo)}&lt;/ns2:arg0>
&lt;/ns2:verificarProtocoloEnviado></con2:xqueryText>
                      </con1:expr>
                    </con1:assign>
                  </con1:requestTransform>
                  <con1:responseTransform>
                    <con1:ifThenElse>
                      <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">verifica retorno e configura variavel local</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-202044905730728479-5d90f9bf.149f7b4a37f.-7ffc</con2:id>
                      <con1:case>
                        <con1:condition>
                          <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$verificarProtocoloEnviadoResponse = true()</con2:xqueryText>
                        </con1:condition>
                        <con1:actions>
                          <con1:assign varName="protocoloEnviado">
                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7f91</con2:id>
                            <con1:expr>
                              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'1'</con2:xqueryText>
                            </con1:expr>
                          </con1:assign>
                        </con1:actions>
                      </con1:case>
                      <con1:default>
                        <con1:assign varName="protocoloEnviado">
                          <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7f91</con2:id>
                          <con1:expr>
                            <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'0'</con2:xqueryText>
                          </con1:expr>
                        </con1:assign>
                      </con1:default>
                    </con1:ifThenElse>
                  </con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default>
              <con1:assign varName="protocoloEnviado">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1094426441919171170--48fbb288.149cfda8dc2.-7f91</con2:id>
                <con1:expr>
                  <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">'0'</con2:xqueryText>
                </con1:expr>
              </con1:assign>
            </con1:default>
          </con1:ifThenElse>
        </con:actions></con:stage><con:stage name="Envio Protocolo" errorHandler="_onErrorHandler-550807396897535505-1fac6b1b.163ef1203e0.-7eb1"><con:comment>Estagio responsavel por enviar o protocolo</con:comment><con:context>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoProposta12V1" prefix="tran" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:userNsDecl namespace="http://www.netservicos.com.br/TransformaIdentificacaoContrato12V1" prefix="tran1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:userNsDecl namespace="http://www.netservicos.com.br/Protocolo" prefix="prt" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:varNsDecl namespace="http://www.netservicos.com.br/EnvioProtocolo" prefix="env" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        <con1:varNsDecl namespace="http://www.netservicos.com.br/MensagemEnvioProtocoloFila" prefix="men" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context><con:actions>
          <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Se protocolo ainda não enviado então solicita o envio</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7ebb</con2:id>
            <con1:case>
              <con1:condition>
                <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$protocoloEnviado = '0'</con2:xqueryText>
              </con1:condition>
              <con1:actions>
                <con1:wsCallout>
                  <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-202044905730728479-5d90f9bf.149f7b4a37f.-7fe4</con2:id>
                  <con1:service xsi:type="ref:BusinessServiceRef" ref="relacionar/atendimento/envioprotocolo/businessservice/EnvioProtocoloServiceEJBBSV1_0" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
                  <con1:operation>enviarProtocolo</con1:operation>
                  <con1:request>
                    <con1:body>$enviarProtocoloRequest</con1:body>
                  </con1:request>
                  <con1:response>
                    <con1:body>enviarProtocoloResponse</con1:body>
                  </con1:response>
                  <con1:requestTransform>
                    <con1:transport-headers copy-all="false">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3620344986528488363-33e777c2.12fc14d4699.-7f80</con2:id>
                      <con1:header-set>outbound-request</con1:header-set>
                      <con1:header name="j_identity_base" value="expression">
                        
                      <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$baseDados</con2:xqueryText></con1:header>
                    </con1:transport-headers><con1:assign varName="enviarProtocoloRequest">
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3120794938986654994--787bb157.149eda2b794.-7ffc</con2:id>
                      <con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="relacionar/atendimento/envioprotocolo/transformation/TransformarEnvioProtocoloRequestXEnviarProtocoloRequestXQuery"/><con2:param name="inbound"><con2:path>$inbound</con2:path></con2:param><con2:param name="mensagemEnvioProtocolo1"><con2:path>$body/men:mensagemEnvioProtocolo</con2:path></con2:param></con2:xqueryTransform></con1:expr>
                    </con1:assign>
                  <con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2329558559929456671--4bbc7741.163f3daef96.-7ff9</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$enviarProtocoloRequest</con3:xqueryText></con2:expr><con2:message>enviarProtocoloRequest</con2:message></con2:log></con1:requestTransform>
                  <con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2329558559929456671--4bbc7741.163f3daef96.-8000</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$enviarProtocoloResponse</con3:xqueryText></con2:expr><con2:message>enviarProtocoloResponse</con2:message></con2:log><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2329558559929456671--4bbc7741.163f3daef96.-7fff</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$enviarProtocoloResponse/prt:protocolo</con3:xqueryText></con2:expr></con2:log></con1:responseTransform>
                </con1:wsCallout>
              </con1:actions>
            </con1:case>
            <con1:default/>
          </con1:ifThenElse>
        </con:actions></con:stage></con:pipeline><con:pipeline type="response" name="Envio Protocolo_response" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"/><con:pipeline name="_onErrorHandler-550807396897535505-1fac6b1b.163ef1203e0.-7f3b" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Tratamento de erro do serviço de identificação da base">
        <con:comment>Tratamento de erro de acesso ao serviço externo de identificação da base.</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f3f</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro ao identificar a base</con1:message>
          </con1:log>
          <con1:assign varName="localMessageParameters" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f3e</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>     
      &lt;logging:value>{'Transforma Identificação Contrato'}&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorHandlerRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f3d</con2:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                <con2:param name="additionalInformation">
                  <con2:path>$null</con2:path>
                </con2:param>
                <con2:param name="currentFault">
                  <con2:path>$fault</con2:path>
                </con2:param>
                <con2:param name="exceptionStackTrace">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="accessResourceName">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="responseSOAPVersion">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="currentBody">
                  <con2:path>$body</con2:path>
                </con2:param>
                <con2:param name="exceptionClassification">
                  <con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path>
                </con2:param>
                <con2:param name="messageParameters">
                  <con2:path>$localMessageParameters</con2:path>
                </con2:param>
                <con2:param name="processo">
                  <con2:path>'atendimento'</con2:path>
                </con2:param>
                <con2:param name="macroProcesso">
                  <con2:path>'RELACIONAR'</con2:path>
                </con2:param>
                <con2:param name="callResponse">
                  <con2:path>$transformaIdentificacaoContratoResponse</con2:path>
                </con2:param>
                <con2:param name="validationMessages">
                  <con2:path>&lt;validationMessages/></con2:path>
                </con2:param>
                <con2:param name="messageCode">
                  <con2:path>'ESB-ATEND-0015'</con2:path>
                </con2:param>
                <con2:param name="currentInbound">
                  <con2:path>$inbound</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f3c</con2:id>
            <con1:errCode>LOCAL_EXCEPTION</con1:errCode>
          </con1:Error>
        </con:actions>
      </con:stage></con:pipeline><con:pipeline name="_onErrorHandler-550807396897535505-1fac6b1b.163ef1203e0.-7f03" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Tratamento de erro ao acessar EJB">
        <con:comment>Tratamento de erro ao verificar se protocolo pode ser enviado</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f07</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro ao verificar envio do protocolo</con1:message>
          </con1:log>
          <con1:assign varName="localMessageParameters" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f06</con2:id>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>
	&lt;logging:value>{'EnvioProtocoloServiceEJB'}&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText>
            </con1:expr>
          </con1:assign>
          <con1:assign varName="errorHandlerRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f05</con2:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                <con2:param name="additionalInformation">
                  <con2:path>$null</con2:path>
                </con2:param>
                <con2:param name="currentFault">
                  <con2:path>$fault</con2:path>
                </con2:param>
                <con2:param name="exceptionStackTrace">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="accessResourceName">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="responseSOAPVersion">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="currentBody">
                  <con2:path>$body</con2:path>
                </con2:param>
                <con2:param name="exceptionClassification">
                  <con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path>
                </con2:param>
                <con2:param name="messageParameters">
                  <con2:path>$localMessageParameters</con2:path>
                </con2:param>
                <con2:param name="processo">
                  <con2:path>'atendimento'</con2:path>
                </con2:param>
                <con2:param name="macroProcesso">
                  <con2:path>'RELACIONAR'</con2:path>
                </con2:param>
                <con2:param name="callResponse">
                  <con2:path>$verificarProtocoloEnviadoResponse</con2:path>
                </con2:param>
                <con2:param name="validationMessages">
                  <con2:path>&lt;validationMessages/></con2:path>
                </con2:param>
                <con2:param name="messageCode">
                  <con2:path>'ESB-ATEND-0015'</con2:path>
                </con2:param>
                <con2:param name="currentInbound">
                  <con2:path>$inbound</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7f04</con2:id>
            <con1:errCode>LOCAL_EXCEPTION</con1:errCode>
          </con1:Error>
        </con:actions>
      </con:stage></con:pipeline><con:pipeline name="_onErrorHandler-550807396897535505-1fac6b1b.163ef1203e0.-7eb1" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Tratamento de erro ao acessar EJB">
        <con:comment>Tratamento de erro ao acessar EJB que realiza o envio do protocolo</con:comment>
        <con:context>
          <con1:userNsDecl namespace="http://www.bea.com/wli/sb/stages/transform/config" prefix="con1" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/logging" prefix="logging" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7eb5</con2:id>
            <con1:logLevel>error</con1:logLevel>
            <con1:expr>
              <con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">$fault</con2:xqueryText>
            </con1:expr>
            <con1:message>Erro ao verificar envio do protocolo</con1:message>
          </con1:log>
          <con1:assign varName="localMessageParameters" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7eb4</con2:id>
            <con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">&lt;excephdlr:messageParameters>
	&lt;logging:value>{'EnvioProtocoloServiceEJBBSV1_0'}&lt;/logging:value>
&lt;/excephdlr:messageParameters></con2:xqueryText></con1:expr>
          </con1:assign>
          <con1:assign varName="errorHandlerRequest" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7eb3</con2:id>
            <con1:expr>
              <con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                <con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/>
                <con2:param name="additionalInformation">
                  <con2:path>$null</con2:path>
                </con2:param>
                <con2:param name="currentFault">
                  <con2:path>$fault</con2:path>
                </con2:param>
                <con2:param name="exceptionStackTrace">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="accessResourceName">
                  <con2:path>''</con2:path>
                </con2:param>
                <con2:param name="responseSOAPVersion">
                  <con2:path>'1.2'</con2:path>
                </con2:param>
                <con2:param name="currentBody">
                  <con2:path>$body</con2:path>
                </con2:param>
                <con2:param name="exceptionClassification">
                  <con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path>
                </con2:param>
                <con2:param name="messageParameters">
                  <con2:path>$localMessageParameters</con2:path>
                </con2:param>
                <con2:param name="processo">
                  <con2:path>'atendimento'</con2:path>
                </con2:param>
                <con2:param name="macroProcesso">
                  <con2:path>'RELACIONAR'</con2:path>
                </con2:param>
                <con2:param name="callResponse">
                  <con2:path>$enviarProtocoloResponse</con2:path>
                </con2:param>
                <con2:param name="validationMessages">
                  <con2:path>&lt;validationMessages/></con2:path>
                </con2:param>
                <con2:param name="messageCode">
                  <con2:path>'ESB-ATEND-0015'</con2:path>
                </con2:param>
                <con2:param name="currentInbound">
                  <con2:path>$inbound</con2:path>
                </con2:param>
              </con2:xqueryTransform>
            </con1:expr>
          </con1:assign>
          <con1:Error xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-550807396897535505-1fac6b1b.163ef1203e0.-7eb2</con2:id>
            <con1:errCode>LOCAL_EXCEPTION</con1:errCode>
          </con1:Error>
        </con:actions>
      </con:stage></con:pipeline><con:pipeline type="error" name="_onErrorHandler-7839667951829878866-3bc8b553.16413d61301.-8000" xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:stage name="Tratamento de Erro"><con:comment>Tratamento de erro geral</con:comment><con:context><con1:userNsDecl namespace="http://www.netservicos.com.br/NETESBExceptionHandler12V1" prefix="excephdlr" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/><con1:userNsDecl namespace="http://www.netservicos.com.br/modelocanonico/v2/errorinfo" prefix="errorInfo" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/></con:context><con:actions><con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7fff</con2:id><con1:logLevel>error</con1:logLevel><con1:message>Tratamento de erro geral do proxy EnvioProtocoloPS.</con1:message></con1:log><con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:comment xmlns:con2="http://www.bea.com/wli/sb/stages/config">Verifica se error handler esta preenchido</con2:comment><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ffe</con2:id><con1:case><con1:condition><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config">empty($errorHandlerRequest)</con2:xqueryText></con1:condition><con1:actions><con1:assign varName="errorHandlerRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ffd</con2:id><con1:expr><con2:xqueryTransform xmlns:con2="http://www.bea.com/wli/sb/stages/config"><con2:resource ref="general/NETESBExceptionHandler/transformation/TransformarEntradaExceptionHandlerXQuery"/><con2:param name="additionalInformation"><con2:path>$body</con2:path></con2:param><con2:param name="currentFault"><con2:path>$fault</con2:path></con2:param><con2:param name="exceptionStackTrace"><con2:path>''</con2:path></con2:param><con2:param name="accessResourceName"><con2:path>'\relacionar\atendimento\protocolo\proxyservice\EnvioProtocoloPS.proxy'</con2:path></con2:param><con2:param name="responseSOAPVersion"><con2:path>'1.2'</con2:path></con2:param><con2:param name="currentBody"><con2:path>$body</con2:path></con2:param><con2:param name="exceptionClassification"><con2:path>'CLASSIFICATION_UNEXPECTED'</con2:path></con2:param><con2:param name="messageParameters"><con2:path>&lt;excephdlr:messageParameters/></con2:path></con2:param><con2:param name="processo"><con2:path>'atendimento'</con2:path></con2:param><con2:param name="macroProcesso"><con2:path>'RELACIONAR'</con2:path></con2:param><con2:param name="callResponse"><con2:path>&lt;excephdlr:messageParameters/></con2:path></con2:param><con2:param name="validationMessages"><con2:path>&lt;validationMessages/></con2:path></con2:param><con2:param name="messageCode"><con2:path>'ESB-ATEND-0003'</con2:path></con2:param><con2:param name="currentInbound"><con2:path>$inbound</con2:path></con2:param></con2:xqueryTransform></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ffb</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$errorHandlerRequest</con3:xqueryText></con2:expr><con2:message>errorHandlerRequest</con2:message></con2:log></con1:actions></con1:case><con1:default/></con1:ifThenElse><con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ffa</con2:id><con1:service xsi:type="ref:ProxyRef" ref="general/NETESBExceptionHandler/proxyservice/NETESBExceptionHandler12V1" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/><con1:operation>convertLocalExceptionToFault</con1:operation><con1:request><con1:body>$errorHandlerRequest</con1:body></con1:request><con1:response><con1:body>errorHandlerResponse</con1:body></con1:response><con1:requestTransform/><con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ff9</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$errorHandlerResponse</con3:xqueryText></con2:expr><con2:message>errorHandlerResponse</con2:message></con2:log></con1:responseTransform></con1:wsCallout><con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ff7</con2:id><con1:service xsi:type="ref:ProxyRef" ref="general/NETLog/proxyservice/FormatLogMessage12" xmlns:ref="http://www.bea.com/wli/sb/reference" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/><con1:operation>formatLogMessage</con1:operation><con1:request><con1:body>$formatLogMessageRequest</con1:body></con1:request><con1:response><con1:body>formatLogMessageResponse</con1:body></con1:response><con1:requestTransform><con1:assign varName="formatLogMessageRequest"><con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ff6</con2:id><con1:expr><con2:xqueryText xmlns:con2="http://www.bea.com/wli/sb/stages/config"><![CDATA[<for:logMessage xmlns:log="http://www.netservicos.com.br/modelocanonico/v2/logging" xmlns:for="http://www.netservicos.com.br/FormatLogMessage">
   <log:transactionId>{fn:data($header//token)}</log:transactionId>
   <log:logType>ERROR</log:logType>
   <log:messageCode>{ fn:data($errorHandlerRequest/excephdlr:messageCode) }</log:messageCode>
   <log:messageParameters/>     
   <log:username>{fn:data($header//username)}</log:username>
   <log:timestamp>{fn:data(fn:current-dateTime())}</log:timestamp>
   <log:errorInfo>{ $errorHandlerResponse//errorInfo:ErrorInfo/@* , $errorHandlerResponse//errorInfo:ErrorInfo/node() }</log:errorInfo>
   <log:macroProcesso>RELACIONAR</log:macroProcesso>
   <log:processo>atendimento</log:processo>
   <log:consumidor>{fn:data($header//aplicacao)}</log:consumidor>
</for:logMessage>]]></con2:xqueryText></con1:expr></con1:assign><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ff5</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$formatLogMessageRequest</con3:xqueryText></con2:expr><con2:message>formatLogMessageRequest</con2:message></con2:log></con1:requestTransform><con1:responseTransform><con2:log xmlns:con2="http://www.bea.com/wli/sb/stages/logging/config"><con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7839667951829878866-3bc8b553.16413d61301.-7ff4</con3:id><con2:logLevel>debug</con2:logLevel><con2:expr><con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">$formatLogMessageResponse</con3:xqueryText></con2:expr><con2:message>formatLogMessageResponse</con2:message></con2:log></con1:responseTransform></con1:wsCallout></con:actions></con:stage></con:pipeline><con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config"><con:pipeline-node name="Envio Protocolo"><con:comment>fluxo para envio de protocolo</con:comment><con:request>Envio Protocolo_request</con:request><con:response>Envio Protocolo_response</con:response></con:pipeline-node></con:flow></ser:router>
</xml-fragment>